<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Swift 5 新特性 | Jovins Blog</title>
    <meta name="description" content="Work Hard, Play Hard">
    <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa6af71c.css" as="style"><link rel="preload" href="/assets/js/app.45c2c56b.js" as="script"><link rel="preload" href="/assets/js/101.255075f9.js" as="script"><link rel="prefetch" href="/assets/js/10.99bbcf46.js"><link rel="prefetch" href="/assets/js/100.4ff47055.js"><link rel="prefetch" href="/assets/js/102.5506cbf3.js"><link rel="prefetch" href="/assets/js/103.590b1952.js"><link rel="prefetch" href="/assets/js/104.16511586.js"><link rel="prefetch" href="/assets/js/11.6995aa03.js"><link rel="prefetch" href="/assets/js/12.d1aeb970.js"><link rel="prefetch" href="/assets/js/13.3808cbb9.js"><link rel="prefetch" href="/assets/js/14.05c65f0c.js"><link rel="prefetch" href="/assets/js/15.79469dcd.js"><link rel="prefetch" href="/assets/js/16.bcec1f4f.js"><link rel="prefetch" href="/assets/js/17.1bac9075.js"><link rel="prefetch" href="/assets/js/18.e3c3b169.js"><link rel="prefetch" href="/assets/js/19.516ccfe4.js"><link rel="prefetch" href="/assets/js/2.abd15c4d.js"><link rel="prefetch" href="/assets/js/20.06f0bcf7.js"><link rel="prefetch" href="/assets/js/21.fe872b4e.js"><link rel="prefetch" href="/assets/js/22.28c254f2.js"><link rel="prefetch" href="/assets/js/23.a835c06c.js"><link rel="prefetch" href="/assets/js/24.3f7228c2.js"><link rel="prefetch" href="/assets/js/25.ac51f988.js"><link rel="prefetch" href="/assets/js/26.b59abae2.js"><link rel="prefetch" href="/assets/js/27.cd3c6c96.js"><link rel="prefetch" href="/assets/js/28.c940ab72.js"><link rel="prefetch" href="/assets/js/29.a359f46e.js"><link rel="prefetch" href="/assets/js/3.eab54b8c.js"><link rel="prefetch" href="/assets/js/30.a11cef84.js"><link rel="prefetch" href="/assets/js/31.e00708c5.js"><link rel="prefetch" href="/assets/js/32.fc57bd53.js"><link rel="prefetch" href="/assets/js/33.a0c36fb1.js"><link rel="prefetch" href="/assets/js/34.ba2e8263.js"><link rel="prefetch" href="/assets/js/35.4e677282.js"><link rel="prefetch" href="/assets/js/36.9606378b.js"><link rel="prefetch" href="/assets/js/37.29b1b26c.js"><link rel="prefetch" href="/assets/js/38.5f2d7b00.js"><link rel="prefetch" href="/assets/js/39.2034fe59.js"><link rel="prefetch" href="/assets/js/4.0dcb83ea.js"><link rel="prefetch" href="/assets/js/40.0149e03c.js"><link rel="prefetch" href="/assets/js/41.09709ee1.js"><link rel="prefetch" href="/assets/js/42.83a36ad7.js"><link rel="prefetch" href="/assets/js/43.4096bb7c.js"><link rel="prefetch" href="/assets/js/44.68a45e4d.js"><link rel="prefetch" href="/assets/js/45.b0d66d41.js"><link rel="prefetch" href="/assets/js/46.54afe46e.js"><link rel="prefetch" href="/assets/js/47.47d0eb4d.js"><link rel="prefetch" href="/assets/js/48.1b1231f9.js"><link rel="prefetch" href="/assets/js/49.8891071c.js"><link rel="prefetch" href="/assets/js/5.20de59e0.js"><link rel="prefetch" href="/assets/js/50.8b0c47c5.js"><link rel="prefetch" href="/assets/js/51.edbcfa00.js"><link rel="prefetch" href="/assets/js/52.9ef337fb.js"><link rel="prefetch" href="/assets/js/53.57cc5779.js"><link rel="prefetch" href="/assets/js/54.575a8bf2.js"><link rel="prefetch" href="/assets/js/55.fa196cbe.js"><link rel="prefetch" href="/assets/js/56.6af43272.js"><link rel="prefetch" href="/assets/js/57.aeaaa632.js"><link rel="prefetch" href="/assets/js/58.d6493831.js"><link rel="prefetch" href="/assets/js/59.13098fb5.js"><link rel="prefetch" href="/assets/js/6.fa56a93f.js"><link rel="prefetch" href="/assets/js/60.3456b434.js"><link rel="prefetch" href="/assets/js/61.3fc7e8c5.js"><link rel="prefetch" href="/assets/js/62.93eb848a.js"><link rel="prefetch" href="/assets/js/63.d3552b8b.js"><link rel="prefetch" href="/assets/js/64.1e43c6b6.js"><link rel="prefetch" href="/assets/js/65.e502d646.js"><link rel="prefetch" href="/assets/js/66.3993e150.js"><link rel="prefetch" href="/assets/js/67.a2d6fc18.js"><link rel="prefetch" href="/assets/js/68.8347a1a2.js"><link rel="prefetch" href="/assets/js/69.d5c60e32.js"><link rel="prefetch" href="/assets/js/7.4718466c.js"><link rel="prefetch" href="/assets/js/70.455b6ca3.js"><link rel="prefetch" href="/assets/js/71.7f1e655e.js"><link rel="prefetch" href="/assets/js/72.5d9dad22.js"><link rel="prefetch" href="/assets/js/73.20f8b883.js"><link rel="prefetch" href="/assets/js/74.e3b904c7.js"><link rel="prefetch" href="/assets/js/75.86230303.js"><link rel="prefetch" href="/assets/js/76.6fcdc539.js"><link rel="prefetch" href="/assets/js/77.5f0e2e7e.js"><link rel="prefetch" href="/assets/js/78.f417d583.js"><link rel="prefetch" href="/assets/js/79.e7ab9a2e.js"><link rel="prefetch" href="/assets/js/8.4c8a9f6d.js"><link rel="prefetch" href="/assets/js/80.1ca3e07c.js"><link rel="prefetch" href="/assets/js/81.26dc6004.js"><link rel="prefetch" href="/assets/js/82.82667bbe.js"><link rel="prefetch" href="/assets/js/83.f028cd44.js"><link rel="prefetch" href="/assets/js/84.665f41fb.js"><link rel="prefetch" href="/assets/js/85.b7a023b4.js"><link rel="prefetch" href="/assets/js/86.3234dd2f.js"><link rel="prefetch" href="/assets/js/87.759f890b.js"><link rel="prefetch" href="/assets/js/88.1b1d06b6.js"><link rel="prefetch" href="/assets/js/89.c13dfa3e.js"><link rel="prefetch" href="/assets/js/9.40dc386c.js"><link rel="prefetch" href="/assets/js/90.df5e8ccd.js"><link rel="prefetch" href="/assets/js/91.585aec72.js"><link rel="prefetch" href="/assets/js/92.b5ef35df.js"><link rel="prefetch" href="/assets/js/93.5789889e.js"><link rel="prefetch" href="/assets/js/94.3d7cdfde.js"><link rel="prefetch" href="/assets/js/95.2327a099.js"><link rel="prefetch" href="/assets/js/96.8c9401b9.js"><link rel="prefetch" href="/assets/js/97.376abc62.js"><link rel="prefetch" href="/assets/js/98.a7355130.js"><link rel="prefetch" href="/assets/js/99.5363e2ff.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa6af71c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jovins Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source/swift/" class="nav-link router-link-active">Swift</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source/swift/" class="nav-link router-link-active">Swift</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>技术文章</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Swift 文章</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/source/swift/" class="sidebar-link">Swift可选类型Optional的用法</a></li><li><a href="/source/swift/RxSwift-5.0.html" class="sidebar-link">RxSwift 5.0 内容更新</a></li><li><a href="/source/swift/Swift-ABI.html" class="sidebar-link">Swift ABI 稳定后的几个问题</a></li><li><a href="/source/swift/Swift-5-original-String.html" class="sidebar-link">Swift 5 中使用原始字符串</a></li><li><a href="/source/swift/swift5-newfuture.html" class="active sidebar-link">Swift 5 新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source/swift/swift5-newfuture.html#app-瘦身" class="sidebar-link">App 瘦身</a></li><li class="sidebar-sub-header"><a href="/source/swift/swift5-newfuture.html#swift-语言" class="sidebar-link">Swift 语言</a></li><li class="sidebar-sub-header"><a href="/source/swift/swift5-newfuture.html#swift-标准库" class="sidebar-link">Swift 标准库</a></li><li class="sidebar-sub-header"><a href="/source/swift/swift5-newfuture.html#swift-包管理器" class="sidebar-link">Swift 包管理器</a></li><li class="sidebar-sub-header"><a href="/source/swift/swift5-newfuture.html#swift-编译器" class="sidebar-link">Swift 编译器</a></li></ul></li><li><a href="/source/swift/Swift-String-Substring.html" class="sidebar-link">Swift中String和Substring</a></li><li><a href="/source/swift/Swift-defer.html" class="sidebar-link">Swift defer 的正确使用</a></li><li><a href="/source/swift/result-types.html" class="sidebar-link">泛型Opaque Result Types</a></li><li><a href="/source/swift/xcode10-2.html" class="sidebar-link">Xcode 10.2</a></li><li><a href="/source/swift/vapor.html" class="sidebar-link">Swift Vapor学习</a></li><li><a href="/source/swift/Swift-4-Codable.html" class="sidebar-link">Swift 4 Codable 协议</a></li><li><a href="/source/swift/Swift-Tuple-inout.html" class="sidebar-link">元组Tuple和其关键字inout</a></li><li><a href="/source/swift/Swift-Protocol.html" class="sidebar-link">Swift 协议 protocol</a></li><li><a href="/source/swift/Swift-Moya-design.html" class="sidebar-link">Moya框架设计浅谈</a></li><li><a href="/source/swift/Swift-Error.html" class="sidebar-link">Swift Error 的分类</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>OpenGL/OpenGL ES</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="swift-5-新特性"><a href="#swift-5-新特性" aria-hidden="true" class="header-anchor">#</a> Swift 5 新特性</h1> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>万众期待的 Swift 5 终于来了，苹果爸爸答应的 ABI 稳定也终于来了。</p></div> <h2 id="app-瘦身"><a href="#app-瘦身" aria-hidden="true" class="header-anchor">#</a> App 瘦身</h2> <h3 id="新特性"><a href="#新特性" aria-hidden="true" class="header-anchor">#</a> 新特性</h3> <p>Swift 应用程序不再包含用于 Swift 标准库的<code>动态链接库</code>和用于运行 <code>iOS 12.2</code>，<code>watchOS 5.2</code> 和 <code>tvOS 12.2</code> 的设备的构建变体中的 <code>Swift SDK overlays</code>。因此，当为 <code>TestFlight</code> 进行测试部署时，或者在为本地开发分发瘦身应用的 <code>archive</code> 包时，Swift 应用程序可以更小。</p> <p>要对比 iOS 12.2 和 iOS 12.1(或更早版本) 瘦身后 App 的文件大小差异，可以设置 App 的 <code>deployment target</code> 为 <code>iOS 12.1</code> 或更早版本，设置 <code>scheme set</code> 为 <code>Generic iOS Device</code> 并生成一个 App 的归档。在构建完成后，在 <code>Archives organizer</code> 选择中 <code>Distribute App</code>，然后选择 <code>Development distribution</code>。确保在 <code>App Thinning</code> 下拉菜单中选择一个特定设备，如 <code>iPhone XS</code>。当分发完成后，在新创建的文件夹下打开 <code>App Thinning Size Report</code>。iOS 12.2 系统的变体将小于 iOS 12.1 及更早的系统的变体。确切的大小差异取决于您的 App 使用的系统框架的数量。</p> <p>关于 App 瘦身更多的信息，可以查看 <a href="https://link.juejin.im?target=https%3A%2F%2Fhelp.apple.com%2Fxcode%2Fmac%2Fcurrent%2F" target="_blank" rel="noopener noreferrer">Xcode Help<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中的 <a href="https://link.juejin.im?target=https%3A%2F%2Fhelp.apple.com%2Fxcode%2Fmac%2Fcurrent%2F%23%2Fdevbbdc5ce4f" target="_blank" rel="noopener noreferrer">What is app thinning?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>有关应用程序文件大小的信息，请参考 <a href="https://link.juejin.im?target=https%3A%2F%2Fhelp.apple.com%2Fapp-store-connect%2F" target="_blank" rel="noopener noreferrer">App Store Connect Help<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中的 <a href="https://link.juejin.im?target=https%3A%2F%2Fhelp.apple.com%2Fapp-store-connect%2F%23%2Fdev3b56ce97c" target="_blank" rel="noopener noreferrer">View builds and file sizes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="swift-语言"><a href="#swift-语言" aria-hidden="true" class="header-anchor">#</a> Swift 语言</h2> <h3 id="新特性-2"><a href="#新特性-2" aria-hidden="true" class="header-anchor">#</a> 新特性</h3> <ul><li><p><code>@dynamicCallable</code> 允许您使用一个简单的语法糖像调用函数一样来调用命名类型。主要的应用场景是动态语言互操作。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0216-dynamic-callable.md" target="_blank" rel="noopener noreferrer">SE-0216<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <p>例如：</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code>@dynamicCallable <span class="token keyword">struct</span> <span class="token builtin">ToyCallable</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> dynamicCall（withArguments：<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span>）<span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">func</span> dynamicCall（withKeywordArguments：<span class="token builtin">KeyValuePairs</span> <span class="token operator">&lt;</span><span class="token builtin">String，Int</span><span class="token operator">&gt;</span>）<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token builtin">ToyCallable</span>（）

x（<span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span>）
<span class="token comment">// 等价于`x.dynamicallyCall（withArguments：[1,2,3]）`</span>

<span class="token function">x</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// 等价于`x.dynamicallyCall(withKeywordArguments: [&quot;label&quot;: 1, &quot;&quot;: 2])`</span>
</code></pre></div><ul><li>Key path 现在支持特性(identity) keypath (<code>\.self</code>)，这是一个引用自身完整输入值的 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fwritablekeypath%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">WritableKeyPath<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0227-identity-keypath.md" target="_blank" rel="noopener noreferrer">SE-0227<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> id <span class="token operator">=</span> \<span class="token builtin">Int</span><span class="token punctuation">.</span><span class="token keyword">self</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">2</span>
<span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>keyPath<span class="token punctuation">:</span> id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Prints &quot;2&quot;</span>
x<span class="token punctuation">[</span>keyPath<span class="token punctuation">:</span> id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>keyPath<span class="token punctuation">:</span> id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Prints &quot;3&quot;</span>
</code></pre></div><ul><li>在 Swift 5 之前，您可以编写一个带有可变参数的枚举 case：</li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">enum</span> X <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token function">foo</span><span class="token punctuation">(</span>bar<span class="token punctuation">:</span> <span class="token builtin">Int</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> X <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>bar<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> 
</code></pre></div><p>之前不是特意要支持这个特性，而且现在这样写会报错了。</p> <p>取而代之的是，让枚举的 <code>case</code> 携带一个数组，并显式传递一个数组</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">enum</span> X <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token function">foo</span><span class="token punctuation">(</span>bar<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> 

<span class="token keyword">func</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> X <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>bar<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> 
</code></pre></div><ul><li><p>在 Swift 5 中，带有一个可选类型的表达式的 <code>try?</code> 将会展平生成的可选项，而不是返回嵌套的可选项。（<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0230-flatten-optional-try.md" target="_blank" rel="noopener noreferrer">SE-0230<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></li> <li><p>如果类型<code>T</code> 符合<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fswift_standard_library%2Finitialization_with_literals%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">Initialized with Literals<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中的其中一个协议（如 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fexpressiblebyintegerliteral%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">ExpressibleByIntegerLiteral<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），且 <code>literal</code> 是一个字面量表达示时，则 <code>T(literal)</code> 会使用相应的协议创建一个类型 <code>T</code> 的字面量，而不是使用一个协议的默认字面量类型的值来调用 <code>T</code> 的 <code>initializer</code>。</p> <p>如，类似于 <code>UInt64(0xffff_ffff_ffff_ffff)</code> 这样的表达式现在是有效的，则之前会由于整型字面量的默认类型是 <code>Int</code>，而导致溢出。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0213-literal-init-via-coercion.md" target="_blank" rel="noopener noreferrer">SE-0213<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></li> <li><p>提高了<code>字符串插值</code>操作的性能、清晰性和效率。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0228-fix-expressiblebystringinterpolation.md" target="_blank" rel="noopener noreferrer">SE-0228<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <p>旧的 <code>_ExpressibleByStringInterpolation</code> 协议被删除；如果您有使用此协议的代码，则需要做相应更新。您可以使用 <code>#if</code> 条件判断来区分 <code>Swift 4.2</code> 和 <code>Swift 5</code> 的代码。例如：</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code>#<span class="token keyword">if</span> <span class="token function">compiler</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">extension</span> <span class="token builtin">MyType</span><span class="token punctuation">:</span> _ExpressibleByStringInterpolation <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
#<span class="token keyword">else</span>
<span class="token keyword">extension</span> <span class="token builtin">MyType</span><span class="token punctuation">:</span> <span class="token builtin">ExpressibleByStringInterpolation</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
#endif 
</code></pre></div><h2 id="swift-标准库"><a href="#swift-标准库" aria-hidden="true" class="header-anchor">#</a> Swift 标准库</h2> <h3 id="新功能"><a href="#新功能" aria-hidden="true" class="header-anchor">#</a> 新功能</h3> <ul><li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fdictionaryliteral%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">DictionaryLiteral<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 类型重命名为 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fkeyvaluepairs%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">KeyValuePairs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0214-DictionaryLiteral.md" target="_blank" rel="noopener noreferrer">SE-0214<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></li> <li><p>桥接到 <code>Objective-C</code> 代码的 <code>Swift</code> 字符串现在可以在适当的时候从 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fcorefoundation%2F1542133-cfstringgetcstringptr%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">CFStringGetCStringPtr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>返回一个 <code>non-nil</code> 值，同时从 <code>-UTF8String</code> 返回的指针与字符串的生命周期相关联，而不是最相近的那个 <code>autorelease pool</code>。如果程序正确，那应该没有任何问题，并且会发现性能显著提高。但是，这也可能会让之前一些未经测试的代码运行，从而暴露一些潜在的问题；例如，如果有一个对 <code>non-nil</code> 值的判断，而相应分支在 Swift 5 之前却从未被执行过。(26236614)</p></li> <li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fsequence%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">Sequence<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 协议不再具有 <code>SubSequence</code> 关联类型。先前返回 <code>SubSequence</code> 的 <code>Sequence</code> 方法现在会返回具体类型。例如，<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fsequence%2F3128822-suffix%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">suffix(_😃<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>现在会返回一个 <code>Array</code>。(47323459)</p> <p>使用 <code>SubSequence</code> 的 <code>Sequence</code> 扩展应该修改为类似地使用具体类型，或者修改为 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fcollection%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">Collection<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的扩展，在 <code>Collection</code> 中 <code>SubSequence</code> 仍然可用。(45761817)</p></li></ul> <p>例如：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">extension</span> <span class="token builtin">Sequence</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">dropTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">SubSequence</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">dropFirst</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>需要改为：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">extension</span> <span class="token builtin">Sequence</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">dropTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">DropFirstSequence</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">dropFirst</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者是：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">extension</span> <span class="token builtin">Collection</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">dropTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">SubSequence</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">dropFirst</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fstring%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">String<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>结构的原生编码将从 <code>UTF-16</code> 切换到 <code>UTF-8</code>，与 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fstring%2Futf16view%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">String.UTF16View<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 相比，这会提高相关联的 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fswift%2Fstring%2Futf8view%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">String.UTF8View<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的性能。重新对所有代码进行评审以提高性能，尤其是使用了 <code>String.UTF16View</code> 的代码。</li></ul> <h2 id="swift-包管理器"><a href="#swift-包管理器" aria-hidden="true" class="header-anchor">#</a> Swift 包管理器</h2> <h3 id="新功能-2"><a href="#新功能-2" aria-hidden="true" class="header-anchor">#</a> 新功能</h3> <ul><li><p>现在，在使用 Swift 5 软件包管理器时，<code>Targets</code> 可以声明一些常用的针对特定目标的 <code>build settings</code> 设置。新设置也可以基于平台和构建配置进行条件化处理。包含的构建设置支持 <code>Swift</code> 和 <code>C</code> 语言定义，<code>C</code> 语言头文件搜索路径，链接库和链接框架。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0238-package-manager-build-settings.md" target="_blank" rel="noopener noreferrer">SE-0238<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)(23270646)</p></li> <li><p>在使用 Swift 5 软件包管理器时，<code>package</code> 现在可以自定义 Apple 平台的最低 <code>deployment target</code>。而如果 <code>package A</code> 依赖于 <code>package B</code>，但 <code>package B</code> 指定的最小 <code>deployment target</code> 高于 package A 的最小 <code>deployment target</code>，则构建 package A 时会抛出错误。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0236-package-manager-platform-deployment-settings.md" target="_blank" rel="noopener noreferrer">SE-0236<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)(28253354)</p></li> <li><p>新的依赖镜像功能允许顶层包覆盖依赖 URL。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0219-package-manager-dependency-mirroring.md" target="_blank" rel="noopener noreferrer">SE-0219<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)(42511642)</p> <p>使用以下命令设置镜像：</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ swift package config set-mirror \
--package-url &lt;original URL&gt; --mirror-url &lt;mirror URL&gt;
</code></pre></div><ul><li><code>swift</code> 测试命令可以使用标志 <code>--enable-code-coverage</code>，来生成标准格式的代码覆盖率数据，以便其它代码覆盖工具使用。生成的代码覆盖率数据存储在 <code>&lt;build-dir&gt;/&lt;configuration&gt;/codecov</code> 目录中。</li> <li>Swift 5 不再支持 <code>Swift 3</code> 版本的软件包管理器。仍然在使用 Swift 3 Package.swift 工具版本（<code>tool-version</code>）上的软件包应该更新到新的工具版本上。</li> <li>对体积较大的包进行包管理器操作现在明显更快了。</li> <li>Swift 包管理器有一个新的 <code>--disable-automatic-resolution</code> 标志项，当 <code>Package.resolved</code> 条目不再与 <code>Package.swift</code> 清单文件中指定的依赖项版本兼容时，该标志项强制包解析失败。此功能对于持续集成系统非常有用，可以检查包的 <code>Package.resolved</code> 是否已过期。</li> <li><code>swift run</code> 命令有一个新的 <code>--repl</code> 选项，它会启动 <code>Swift REPL</code>，支持导入包的库目标。这使您可以轻松地从包目标中试用 API，而无需构建调用该 API 的可执行文件。</li> <li>有关使用 Swift 包管理器的更多信息，请访问 <a href="https://link.juejin.im?target=https%3A%2F%2Fswift.org%2F" target="_blank" rel="noopener noreferrer">swift.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上的 <a href="https://link.juejin.im?target=https%3A%2F%2Fswift.org%2Fgetting-started%2F%23using-the-package-manager" target="_blank" rel="noopener noreferrer">Using the Package Manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <h2 id="swift-编译器"><a href="#swift-编译器" aria-hidden="true" class="header-anchor">#</a> Swift 编译器</h2> <h3 id="新特性-3"><a href="#新特性-3" aria-hidden="true" class="header-anchor">#</a> 新特性</h3> <ul><li><p>现在，在优化（<code>-O</code> 和 <code>-Osize</code>）构建中，默认情况下在运行时强制执行独占内存访问。违反排他性的程序将在运行时抛出带有“重叠访问”诊断消息错误。您可以使用命令行标志禁用此命令：<code>-enforce-exclusivity = unchecked</code>，但这样做可能会导致未定义的行为。运行时违反排他性通常是由于同时访问类属性，全局变量（包括顶层代码中的变量）或通过 <code>eacaping</code> 闭包捕获的变量。（<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-7139" target="_blank" rel="noopener noreferrer">SR-7139<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p></li> <li><p>Swift 3 运行模式已被删除。<code>-swift-version</code> 标志支持的值为 <code>4</code>、<code>4.2</code> 和 <code>5</code>。</p></li> <li><p>在 Swift 5 中，在 <code>switch</code> 语句中使用 <code>Objective-C</code> 中声明的或来自系统框架的枚举时，必须处理未知的 <code>case</code>，这些 <code>case</code> 可能将来会添加，也可能是在 <code>Objective-C</code>实现文件中私下定义。形式上，<code>Objective-C</code> 允许在枚举中存储任何值，只要它匹配底层类型即可。这些未知的 <code>case</code> 可以使用新的 <code>@unknown default case</code> 来处理，当然如果 <code>switch</code> 中省略了任何已知的 <code>case</code>，编译器仍然会给出警告。它们也可以使用普通的 <code>default case</code> 来处理。</p> <p>如果您已在 <code>Objective-C</code> 中定义了自己的枚举，并且不需要客户端来处理 <code>unknown case</code>，则可以使用 <code>NS_CLOSED_ENUM</code> 宏而不是 <code>NS_ENUM</code>。Swift 编译器识别出这一点，并且不需求 <code>switch</code> 语句必须带有 <code>default case</code>。</p> <p>在 <code>Swift 4</code> 和 <code>4.2</code> 模式下，您仍然可以使用 <code>@unknown default</code>。如果省略 <code>@unknown default</code>，而又传递了一个未知的值，则程序在运行时抛出异常，这与 <code>Xcode 10.1</code> 中的 <code>Swift 4.2</code> 上的行为是一致的。(<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0192-non-exhaustive-enums.md" target="_blank" rel="noopener noreferrer">SE-0192<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)(39367045)</p></li> <li><p>现在在 <code>SourceKit</code> 生成的 Swift 模块接口中会打印默认参数，而不仅仅是使用占位符。</p></li> <li><p><code>unowned</code> 和 <code>unowned(unsafe)</code> 类型的变量现在支持可选类型。</p></li></ul> <h3 id="已知的问题"><a href="#已知的问题" aria-hidden="true" class="header-anchor">#</a> 已知的问题</h3> <ul><li>如果引用了 <code>UIAccessibility</code> 结构的任何成员，则 Swift 编译器会在 “<code>Merge swiftmodule</code>” 构建步骤中崩溃。构建日志包含一条消息：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Cross-reference to module 'UIKit'
... UIAccessibility
... in an extension in module 'UIKit'
... GuidedAccessError 
复制代码
</code></pre></div><p>包含 <code>NS_ERROR_ENUM</code> 枚举的其他类型也可能出现此问题，但 <code>UIAccessibility</code> 是最常见的。(47152185)</p> <p><strong>解决方法</strong>：在 <code>target</code> 的 <code>Build Setting -&gt; Swift Compiler -&gt; Code Generation</code> 下，设置 <code>Compilation Mode</code> 的值为 <code>Whole Module</code>。这是大多数 <code>Release</code> 配置的默认设置。</p> <ul><li><p>为了减小 <code>Swift</code> 元数据的大小，Swift 中定义的 <code>convenience initializers</code> 如果调用了 <code>Objective-C</code> 中定义的一个 <code>designated initializer</code>，那只会提前分配一个对象。在大多数情况下，这对您的程序没有影响，但如果从 <code>Objective-C</code> 调用 <code>convenience initializers</code>，那么 <code>+alloc</code> 分配的初始内存会被释放，而不会调用任何 <code>initializer</code>。对于不希望发生任何类型的对象替换的调用者来说，这可能是有问题的。其中一个例子是 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Ffoundation%2Fnscoding%2F1416145-initwithcoder%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">initWithCoder:<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ：如果 <a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Ffoundation%2Fnskeyedunarchiver%3Flanguage%3Dobjc" target="_blank" rel="noopener noreferrer">NSKeyedUnarchiver<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 调用 <code>Swift</code> 实现 <code>init(coder:)</code> 并且存档对象存在循环时，则 <code>NSKeyedUnarchiver</code> 的实现可能会出错。</p> <p>在将来的版本中，编译器将保证一个 <code>convenience initializer</code> 永远不会丢弃它所调用的对象，只要它通过 <code>self.init</code> 委托给它的初始化程序也暴露给 <code>Objective-C</code>，或者是它在 <code>Objective-C</code> 中定义了，或者是使用 <code>@objc</code> 标记的，或者是重写了一个暴露给 <code>Objective-C</code> 的 <code>initializer</code>，或者是它满足 <code>@objc</code> 协议的要求。(46823518)</p></li> <li><p>如果一个 <code>keypath</code> 字面量引用了 <code>Objective-C</code> 中定义的属性，或者是在 <code>Swift</code> 中使用 <code>@objc</code> 和 <code>dynamic</code> 修饰符定义的属性，则编译可能会失败，并且报 “<code>unsupported relocation of local symbol 'L_selector'</code>” 错误，或者 key path 字面量无法在运行时生成正确的哈希值或处理相等比较。</p> <p><strong>解决方法</strong>：您可以定义一个不是 <code>@objc</code> 修饰的包装属性，来引用这个 <code>key path</code>。得到的 <code>key path</code> 与引用原始 <code>Objective-C</code> 属性的 <code>key path</code> 不相等，但使用包装属性效果是相同的。</p></li> <li><p>某些项目可能会遇到以前版本的编译时回归。</p></li> <li><p>Swift 命令行项目在启动时因抛出 “<code>dyld：Library not loaded</code>” 错误而崩溃。</p> <p><strong>解决方法</strong>：添加自定义的构建设置 <code>SWIFT_FORCE_STATIC_LINK_STDLIB=YES</code>。</p></li></ul> <h3 id="已解决的问题"><a href="#已解决的问题" aria-hidden="true" class="header-anchor">#</a> 已解决的问题</h3> <ul><li><p>扩展绑定现在支持嵌套类型的扩展，这些嵌套类型本身是在扩展内定义的。之前可能会因为一些声明顺序而失败，并产生 “未声明类型” 错误。(<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-631" target="_blank" rel="noopener noreferrer">SR-631<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></li> <li><p>在 Swift 5 中，返回 <code>Self</code> 的类方法不能再被使用返回非 <code>final</code> 的具体类类型的方法来覆盖。此类代码不是类型安全的，需要更新。(<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-695" target="_blank" rel="noopener noreferrer">SR-695<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <p>例如：</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span> 
    <span class="token keyword">class</span> <span class="token class-name">func</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 

<span class="token keyword">class</span> <span class="token class-name">Derived</span><span class="token punctuation">:</span> <span class="token builtin">Base</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">override</span> <span class="token keyword">func</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Derived</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre></div><ul><li><p>在 Swift 5 模式下，现在会明确禁止声明与嵌套类型同名的静态属性。以前，可以在泛型类型的扩展中执行这样的声明。(<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-7251" target="_blank" rel="noopener noreferrer">SR-7251<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <p>例如：</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">struct</span> <span class="token builtin">Foo</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token builtin">Foo</span> <span class="token punctuation">{</span> 
    <span class="token keyword">struct</span> i <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// Error: Invalid redeclaration of 'i'.</span>
    <span class="token comment">// (Prior to Swift 5, this didn’t produce an error.) </span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token builtin">Int</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>现在可以在子类里继承父类中具有可变参数的初始化方法。</p></li> <li><p>在 Swift 5 中，函数中的 <code>@autoclosure</code> 参数不能再作为 <code>@autoclosure</code> 参数传递到另一个函数中调用。相反，您必须使用括号显式调用函数值:<code>()</code>；调用本身包含在一个隐式闭包中，保证了与 <code>Swift 4</code> 相同的行为。（<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-5719" target="_blank" rel="noopener noreferrer">SR-5719<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <p>例如：</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">_</span> fn<span class="token punctuation">:</span> @autoclosure <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">_</span> fn<span class="token punctuation">:</span> @autoclosure <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment">// Incorrect, `fn` can’t be forwarded and has to be called.</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// OK</span>
<span class="token punctuation">}</span> 
</code></pre></div><ul><li><p>现在完全支持在类和泛型中定义复杂的递归类型，而此前可能会导致死锁。</p></li> <li><p>在 Swift 5 中，当将可选值转换为泛型占位符类型时，编译器在解包值时会更加谨慎。这种转换的结果现在更接近于非泛型上下文中的结果。(<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-4248" target="_blank" rel="noopener noreferrer">SR-4248<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <p>例如：</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">func</span> forceCast<span class="token operator">&lt;</span>U<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">_</span> value<span class="token punctuation">:</span> <span class="token builtin">Any</span><span class="token operator">?</span><span class="token punctuation">,</span> to type<span class="token punctuation">:</span> U<span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> U <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token keyword">as</span><span class="token operator">!</span> U 
<span class="token punctuation">}</span> 

<span class="token keyword">let</span> value<span class="token punctuation">:</span> <span class="token builtin">Any</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token number">42</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">forceCast</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token builtin">Any</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// Prints &quot;Optional(42)&quot;</span>
<span class="token comment">// (Prior to Swift 5, this would print &quot;42&quot;.)</span>

<span class="token function">print</span><span class="token punctuation">(</span>value <span class="token keyword">as</span><span class="token operator">!</span> <span class="token builtin">Any</span><span class="token punctuation">)</span>
<span class="token comment">// Prints &quot;Optional(42)&quot;</span>
</code></pre></div><ul><li>协议现在可以将它们的实现类型限定为指定类型的子类。支持两种等效形式：</li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">protocol</span> <span class="token builtin">MyView</span><span class="token punctuation">:</span> <span class="token builtin">UIView</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
<span class="token keyword">protocol</span> <span class="token builtin">MyView</span> <span class="token keyword">where</span> <span class="token keyword">Self</span><span class="token punctuation">:</span> <span class="token builtin">UIView</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span> 
</code></pre></div><p>Swift 4.2 接受了第二种形式，但没有完全实现，有时可能在编译时或运行时崩溃。(<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-5581" target="_blank" rel="noopener noreferrer">SR-5581<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <ul><li>在 Swift 5 中，当在属性自身的 <code>didSet</code> 或 <code>willSet</code> 中设置属性本身时，会避免递归调用（不论是隐式或显式地设置自身的属性）。(<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-419" target="_blank" rel="noopener noreferrer">SR-419<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</li></ul> <p>例如：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">Node</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token keyword">var</span> depth<span class="token punctuation">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token keyword">didSet</span> <span class="token punctuation">{</span> 
            <span class="token keyword">if</span> depth <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
                <span class="token comment">// Won’t recursively call didSet, because this is setting depth on self. </span>
                depth <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token punctuation">}</span> 

            <span class="token comment">// Will call didSet for each of the children,</span>
            <span class="token comment">// as this isn’t setting the property on self.</span>
            <span class="token comment">// (Prior to Swift 5, this didn’t trigger property</span>
            <span class="token comment">// observers to be called again.)</span>
            <span class="token keyword">for</span> child <span class="token keyword">in</span> children <span class="token punctuation">{</span> 
                child<span class="token punctuation">.</span>depth <span class="token operator">=</span> depth <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Xcode中 的 <code>diagnostics</code> 对 <code>#sourceLocation</code> 进行了支持。也就是说，如果您使用<code>#sourceLocation</code> 将生成的文件中的行映射回源代码时，<code>diagnostics</code> 会显示在原始源文件中的行数而不是生成的文件中的。</li> <li>使用泛型类型别名作为参数或 <code>@objc</code> 方法的返回类型，不再导致生成无效的 <code>Objective-C header</code>。(<a href="https://link.juejin.im?target=https%3A%2F%2Fbugs.swift.org%2Fbrowse%2FSR-8697" target="_blank" rel="noopener noreferrer">SR-8697<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/source/swift/Swift-5-original-String.html" class="prev">
          Swift 5 中使用原始字符串
        </a></span> <span class="next"><a href="/source/swift/Swift-String-Substring.html">
          Swift中String和Substring
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.45c2c56b.js" defer></script><script src="/assets/js/101.255075f9.js" defer></script>
  </body>
</html>
