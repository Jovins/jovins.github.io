<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Texture 布局 | Jovins Blog</title>
    <meta name="description" content="Work Hard, Play Hard">
    <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa6af71c.css" as="style"><link rel="preload" href="/assets/js/app.27fa633f.js" as="script"><link rel="preload" href="/assets/js/5.1d8544f7.js" as="script"><link rel="prefetch" href="/assets/js/10.48b5673d.js"><link rel="prefetch" href="/assets/js/100.5f88fceb.js"><link rel="prefetch" href="/assets/js/101.4f69e052.js"><link rel="prefetch" href="/assets/js/102.eabeb3b1.js"><link rel="prefetch" href="/assets/js/11.6ec4d08e.js"><link rel="prefetch" href="/assets/js/12.201419c3.js"><link rel="prefetch" href="/assets/js/13.fd428174.js"><link rel="prefetch" href="/assets/js/14.dd71103d.js"><link rel="prefetch" href="/assets/js/15.ad5a4b90.js"><link rel="prefetch" href="/assets/js/16.c789f2c5.js"><link rel="prefetch" href="/assets/js/17.3abe720a.js"><link rel="prefetch" href="/assets/js/18.74328b19.js"><link rel="prefetch" href="/assets/js/19.3f0de4f7.js"><link rel="prefetch" href="/assets/js/2.32edc32a.js"><link rel="prefetch" href="/assets/js/20.c9776159.js"><link rel="prefetch" href="/assets/js/21.e2ec6a80.js"><link rel="prefetch" href="/assets/js/22.8396da12.js"><link rel="prefetch" href="/assets/js/23.1ced4eb1.js"><link rel="prefetch" href="/assets/js/24.4f16c5ad.js"><link rel="prefetch" href="/assets/js/25.24ac44c1.js"><link rel="prefetch" href="/assets/js/26.cc6169e3.js"><link rel="prefetch" href="/assets/js/27.2dcef16a.js"><link rel="prefetch" href="/assets/js/28.da3db33d.js"><link rel="prefetch" href="/assets/js/29.bde241c1.js"><link rel="prefetch" href="/assets/js/3.c2b40399.js"><link rel="prefetch" href="/assets/js/30.37e49856.js"><link rel="prefetch" href="/assets/js/31.31d5d30e.js"><link rel="prefetch" href="/assets/js/32.8d17785f.js"><link rel="prefetch" href="/assets/js/33.bfa759ee.js"><link rel="prefetch" href="/assets/js/34.ab946428.js"><link rel="prefetch" href="/assets/js/35.886bd0fc.js"><link rel="prefetch" href="/assets/js/36.8332f511.js"><link rel="prefetch" href="/assets/js/37.a683f0c4.js"><link rel="prefetch" href="/assets/js/38.1130d948.js"><link rel="prefetch" href="/assets/js/39.c1a90c6c.js"><link rel="prefetch" href="/assets/js/4.df0f6c87.js"><link rel="prefetch" href="/assets/js/40.68e5f5d1.js"><link rel="prefetch" href="/assets/js/41.e166d322.js"><link rel="prefetch" href="/assets/js/42.f66f3413.js"><link rel="prefetch" href="/assets/js/43.64022470.js"><link rel="prefetch" href="/assets/js/44.df1a81ff.js"><link rel="prefetch" href="/assets/js/45.40f3050d.js"><link rel="prefetch" href="/assets/js/46.fb4ecc04.js"><link rel="prefetch" href="/assets/js/47.2ced06a4.js"><link rel="prefetch" href="/assets/js/48.a048e5e2.js"><link rel="prefetch" href="/assets/js/49.2b914fc6.js"><link rel="prefetch" href="/assets/js/50.7f1b1f9f.js"><link rel="prefetch" href="/assets/js/51.4502a9d7.js"><link rel="prefetch" href="/assets/js/52.b1f0a307.js"><link rel="prefetch" href="/assets/js/53.f8021a90.js"><link rel="prefetch" href="/assets/js/54.d19f62f6.js"><link rel="prefetch" href="/assets/js/55.24d6baf6.js"><link rel="prefetch" href="/assets/js/56.8901d945.js"><link rel="prefetch" href="/assets/js/57.730f28d8.js"><link rel="prefetch" href="/assets/js/58.dc83d29e.js"><link rel="prefetch" href="/assets/js/59.3fefe72e.js"><link rel="prefetch" href="/assets/js/6.930a4a29.js"><link rel="prefetch" href="/assets/js/60.6e29abc7.js"><link rel="prefetch" href="/assets/js/61.52ef1f85.js"><link rel="prefetch" href="/assets/js/62.4ce6a6c1.js"><link rel="prefetch" href="/assets/js/63.e1c0d65a.js"><link rel="prefetch" href="/assets/js/64.8cecdf9a.js"><link rel="prefetch" href="/assets/js/65.100ab7d9.js"><link rel="prefetch" href="/assets/js/66.8e2fb8ec.js"><link rel="prefetch" href="/assets/js/67.6f7f784e.js"><link rel="prefetch" href="/assets/js/68.9399e2c7.js"><link rel="prefetch" href="/assets/js/69.56939c4c.js"><link rel="prefetch" href="/assets/js/7.47ae4fc9.js"><link rel="prefetch" href="/assets/js/70.6f1f7923.js"><link rel="prefetch" href="/assets/js/71.7d22b53a.js"><link rel="prefetch" href="/assets/js/72.00e52741.js"><link rel="prefetch" href="/assets/js/73.1e034f8a.js"><link rel="prefetch" href="/assets/js/74.9629d356.js"><link rel="prefetch" href="/assets/js/75.4b43f2fd.js"><link rel="prefetch" href="/assets/js/76.62aded62.js"><link rel="prefetch" href="/assets/js/77.fb39664b.js"><link rel="prefetch" href="/assets/js/78.6c09c079.js"><link rel="prefetch" href="/assets/js/79.d812472f.js"><link rel="prefetch" href="/assets/js/8.4cd07d5a.js"><link rel="prefetch" href="/assets/js/80.f4371c92.js"><link rel="prefetch" href="/assets/js/81.087ec454.js"><link rel="prefetch" href="/assets/js/82.eaa18534.js"><link rel="prefetch" href="/assets/js/83.2108209e.js"><link rel="prefetch" href="/assets/js/84.a7d665b3.js"><link rel="prefetch" href="/assets/js/85.d95c8091.js"><link rel="prefetch" href="/assets/js/86.0da15b4b.js"><link rel="prefetch" href="/assets/js/87.4362ca6e.js"><link rel="prefetch" href="/assets/js/88.40c29652.js"><link rel="prefetch" href="/assets/js/89.370187c7.js"><link rel="prefetch" href="/assets/js/9.71ade74a.js"><link rel="prefetch" href="/assets/js/90.9a24cd47.js"><link rel="prefetch" href="/assets/js/91.23d91333.js"><link rel="prefetch" href="/assets/js/92.8f8ee77a.js"><link rel="prefetch" href="/assets/js/93.5d66e696.js"><link rel="prefetch" href="/assets/js/94.2c53a5e8.js"><link rel="prefetch" href="/assets/js/95.be78fcbe.js"><link rel="prefetch" href="/assets/js/96.2b81fe22.js"><link rel="prefetch" href="/assets/js/97.3cf3bc4f.js"><link rel="prefetch" href="/assets/js/98.2ebd7c9b.js"><link rel="prefetch" href="/assets/js/99.63715c1a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa6af71c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jovins Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source/swift/" class="nav-link router-link-active">Swift</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source/swift/" class="nav-link router-link-active">Swift</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>技术文章</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/source/swift/Texture-note.html" class="sidebar-link">Texture 开发笔记</a></li><li><a href="/source/swift/Texture-official-concept.html" class="sidebar-link">Texture 基本概念</a></li><li><a href="/source/swift/Texture-official-layout.html" class="active sidebar-link">Texture 布局</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source/swift/Texture-official-layout.html#布局快速" class="sidebar-link">布局快速</a></li><li class="sidebar-sub-header"><a href="/source/swift/Texture-official-layout.html#布局示例" class="sidebar-link">布局示例</a></li><li class="sidebar-sub-header"><a href="/source/swift/Texture-official-layout.html#布局规则-layout-specs" class="sidebar-link">布局规则/Layout Specs</a></li><li class="sidebar-sub-header"><a href="/source/swift/Texture-official-layout.html#布局元素属性-layout-element-properties" class="sidebar-link">布局元素属性/Layout Element Properties</a></li><li class="sidebar-sub-header"><a href="/source/swift/Texture-official-layout.html#layout-transition-api" class="sidebar-link">Layout Transition API</a></li></ul></li><li><a href="/source/swift/UIScrollView-touch-conflict.html" class="sidebar-link">UIScrollView嵌套滚动解决手势冲突</a></li><li><a href="/source/swift/Reading-List.html" class="sidebar-link">Reading List</a></li><li><a href="/source/swift/2018-reporter.html" class="sidebar-link">2018-小记</a></li><li><a href="/source/swift/iOS-Memory-explore.html" class="sidebar-link">iOS内存管理探究</a></li><li><a href="/source/swift/fastlane-auto-dev.html" class="sidebar-link">fastlane自动化开发组件</a></li><li><a href="/source/swift/dev-component.html" class="sidebar-link">组件化开发之开发小组件</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Swift 文章</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>OpenGL/OpenGL ES</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="texture-布局"><a href="#texture-布局" aria-hidden="true" class="header-anchor">#</a> Texture 布局</h1> <p><img src="/assets/img/NestedScrolling-00.4046a746.png" alt></p> <p><a href="https://github.com/TextureGroup/Texture" target="_blank" rel="noopener noreferrer">Texture<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://texturegroup.org/docs/getting-started.html" target="_blank" rel="noopener noreferrer">Texture文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="布局快速"><a href="#布局快速" aria-hidden="true" class="header-anchor">#</a> 布局快速</h2> <p><strong>开发初衷和优势</strong></p> <p>Layout API 的出现是为了提供一种可以替代 UIKit Auto Layout 的高性能方案，UIKit Auto Layout 在复杂的视图结构中，计算量会呈指数级增长，Texture 的布局方案相对 Auto Layout 有以下优点：</p> <ul><li>快：Texture 的布局计算和手写 Frame 一样的快；</li> <li>异步和并发：布局可以在后台线程上计算，用户交互不会因此而中断；</li> <li>声明式渲染：布局使用不可变的数据结构声明，这让布局代码变得更容易开发、维护、调试、测试和评审；</li> <li>可缓存：如果布局是不可变的，布局可以在后台预先计算和缓存起来，让用户感觉更快；</li> <li>可扩展：代码易于复用；</li></ul> <p><strong>灵感来自于 CSS Flexbox</strong></p> <p>熟悉 Flexbox 的人会注意到这两个系统有许多的相似之处， 但 Layout API 并没有重新实现所有的 CSS。<a href="http://texturegroup.org/docs/layout2-web-flexbox-differences.html" target="_blank" rel="noopener noreferrer">Texture | Web Flexbox Differences<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>基本概念</strong></p> <p>Texture 的布局主要围绕两个概念展开：</p> <ol><li>布局规则</li> <li>布局元素</li></ol> <p><strong>布局规则/Layout Specs</strong></p> <p>布局规则没有物理存在，它通过充当 <code>LayoutElements</code> 的容器，理解多个  <code>LayoutElements</code> 之间的关联，完成 <code>LayoutElements</code> 的位置排列。Texture 提供了 <code>ASLayoutSpec</code> 的几个子类，涵盖了从插入单个布局元素的简单规则，到可以变化堆放排列配置，包含多个布局元素的复杂规则。</p> <p><strong>布局元素/Layout Elements</strong></p> <p><code>LayoutSpecs</code> 包含 <code>LayoutElements</code>，并对 <code>LayoutElements</code> 进行整理。</p> <p>所有的 <code>ASDisplayNode</code>  和 <code>ASLayoutSpec</code> 都遵守 <code>&lt;ASLayoutElement&gt;</code> 协议，这意味着你可以通过两个 <code>Nodes</code> 和其他的 <code>LayoutSpecs</code>，生成或者组合一个新的 <code>LayoutSpecs</code>。</p> <p><code>&lt;ASLayoutElement&gt;</code> 协议有一些属性用于创建非常复杂的布局。 另外，<code>LayoutSpecs</code> 也有自己的一组属性，可以调整布局元素的排列。</p> <p><strong>结合布局规则和布局元素制作复杂界面</strong></p> <p>在这里，你可以看到黄色突出显示的 <code>ASTextNodes</code>，顶部图像 <code>ASVideoNode</code> 和盒子布局规则 <code>ASStackLayoutSpec</code> 是如何组合并创建了一个复杂界面。</p> <p><img src="/assets/img/texture-official-01.315f8054.png" alt></p> <p>使用中心布局规则 <code>ASCenterLayoutSpec</code> 和覆盖布局规则 <code>ASOverlayLayoutSpec</code>，来放置顶部图像 <code>ASVideoNode</code> 中的播放按钮。</p> <p><img src="/assets/img/texture-official-02.ed9639ba.png" alt></p> <p><strong>一些 Node 需要设定 size</strong></p> <p>根据元素的即时可用内容，它们有一个固有大小，比如，<code>ASTextNode</code> 可以根据 <code>.string</code> 属性，确定自身的 size，其他具有固有大小的 <code>Node</code> 有：</p> <ul><li><code>ASImageNode</code></li> <li><code>ASTextNode</code></li> <li><code>ASButtonNode</code></li></ul> <p>所有其他的 <code>Node</code> 在加载外部资源之前，或者没有固有大小，或者缺少一个固有大小。例如，在从 URL 下载图像之前，<code>ASNetworkImageNode</code> 并不能确定它的大小，这些元素包括：</p> <ul><li><code>ASVideoNode</code></li> <li><code>ASVideoPlayerNode</code></li> <li><code>ASNetworkImageNode</code></li> <li><code>ASEditableTextNode</code></li></ul> <p>缺少初始固有大小的这些 <code>Node</code> 必须使用 <code>ASRatioLayoutSpec(比例布局规则)</code>、<code>ASAbsoluteLayoutSpec(绝对布局规则)</code> 或样式对象的 <code>.size</code> 属性为它们设置初始大小。</p> <p><strong>布局调试/Layout Debugging</strong></p> <p>在任何 <code>ASDisplayNode</code> 或 <code>ASLayoutSpec</code> 上调用 <code>-asciiArtString</code> 都会返回该对象及其子项的字符图。 你也可以在任何 <code>Node</code> 或 <code>layoutSpec</code> 中设置 <code>.debugName</code>，这样也将包含字符图，下面是一个示例：</p> <div class="language- extra-class"><pre class="language-text"><code>-----------------------ASStackLayoutSpec----------------------
|  -----ASStackLayoutSpec-----  -----ASStackLayoutSpec-----  |
|  |       ASImageNode       |  |       ASImageNode       |  |
|  |       ASImageNode       |  |       ASImageNode       |  |
|  ---------------------------  ---------------------------  |
--------------------------------------------------------------复制代码
</code></pre></div><p>你还可以在任何 <code>ASLayoutElement</code> ，比如 <code>Node</code> 和 <code>layoutSpec</code> 上打印样式对象，这在调试 <code>.size</code> 属性时特别有用。</p> <div class="language- extra-class"><pre class="language-text"><code>(lldb) po _photoImageNode.style
Layout Size = min {414pt, 414pt} &lt;= preferred {20%, 50%} &lt;= max {414pt, 414pt}
</code></pre></div><h2 id="布局示例"><a href="#布局示例" aria-hidden="true" class="header-anchor">#</a> 布局示例</h2> <p>点击查看<code>layoutSpec</code> 的<a href="https://github.com/texturegroup/texture/tree/master/examples/LayoutSpecExamples" target="_blank" rel="noopener noreferrer">示例工程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>简单的文本左对齐和右对齐：</p> <p><img src="/assets/img/texture-official-03.f96fb612.png" alt></p> <p>为了创建这个一个布局，我们将使用：</p> <ul><li>表示垂直的 <code>ASStackLayoutSpec</code> ；</li> <li>表示水平的 <code>ASStackLayoutSpec</code> ；</li> <li>插入标题的 <code>ASInsetLayoutSpec</code> ；</li></ul> <p>下图展示了一个由 <code>Node</code> 和 <code>LayoutSpecs</code> 组成的布局元素：</p> <p><img src="/assets/img/texture-official-04.c20f2a49.png" alt="img"></p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">class</span> <span class="token class-name">TZYVC</span><span class="token punctuation">:</span> <span class="token builtin">ASViewController</span><span class="token operator">&lt;</span><span class="token builtin">ASDisplayNode</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token function">TZYNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>node<span class="token punctuation">:</span> node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        node<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token builtin">UIColor</span><span class="token punctuation">.</span>red
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TZYNode</span><span class="token punctuation">:</span> <span class="token builtin">ASDisplayNode</span> <span class="token punctuation">{</span>

    <span class="token comment">// 图中的 san fran ca</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> postLocationNode<span class="token punctuation">:</span> <span class="token builtin">ASTextNode</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">ASTextNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 图中的 hannahmbanana</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> userNameNode<span class="token punctuation">:</span> <span class="token builtin">ASTextNode</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">ASTextNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 图中的 30m</span>
    <span class="token keyword">lazy</span> <span class="token keyword">var</span> postTimeNode<span class="token punctuation">:</span> <span class="token builtin">ASTextNode</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">ASTextNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>postLocationNode<span class="token punctuation">.</span>attributedText <span class="token operator">=</span> <span class="token function">NSAttributedString</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;san fran ca&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>userNameNode<span class="token punctuation">.</span>attributedText <span class="token operator">=</span> <span class="token function">NSAttributedString</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;hannahmbanana&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>postTimeNode<span class="token punctuation">.</span>attributedText <span class="token operator">=</span> <span class="token function">NSAttributedString</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;30m&quot;</span><span class="token punctuation">)</span>
        <span class="token function">addSubnode</span><span class="token punctuation">(</span>postLocationNode<span class="token punctuation">)</span>
        <span class="token function">addSubnode</span><span class="token punctuation">(</span>userNameNode<span class="token punctuation">)</span>
        <span class="token function">addSubnode</span><span class="token punctuation">(</span>postTimeNode<span class="token punctuation">)</span>
        postTimeNode<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>brown
        userNameNode<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>cyan
        postLocationNode<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">.</span>green
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> <span class="token punctuation">{</span>
        <span class="token comment">// 声明一个垂直排列的盒子</span>
        <span class="token keyword">let</span> nameLoctionStack <span class="token operator">=</span> <span class="token builtin">ASStackLayoutSpec</span><span class="token punctuation">.</span><span class="token function">vertical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 定义了项目的缩小比例，默认为 1，即如果空间不足，该项目将缩小</span>
        <span class="token comment">// 如所有元素都为 1，空间不足时，所有元素等比例缩放</span>
        <span class="token comment">// 如其中一个是 0，则此元素不缩放，其他元素均分剩余空间</span>
        nameLoctionStack<span class="token punctuation">.</span>style<span class="token punctuation">.</span>flexShrink <span class="token operator">=</span> <span class="token number">1.0</span>
        <span class="token comment">// 定义元素的放大比例，默认为 0，即如果存在剩余空间，也不放大</span>
        <span class="token comment">// 如所有元素都为 1，均分剩余空间</span>
        <span class="token comment">// 如其中一个为 2，那么这个元素占据的空间是其他元素的一倍</span>
        nameLoctionStack<span class="token punctuation">.</span>style<span class="token punctuation">.</span>flexGrow <span class="token operator">=</span> <span class="token number">1.0</span>
        <span class="token comment">// 根据定位地址 node 是否赋值，确定是否将其加入视图</span>
        <span class="token keyword">if</span> postLocationNode<span class="token punctuation">.</span>attributedText <span class="token operator">!=</span> <span class="token constant">nil</span> <span class="token punctuation">{</span>
            nameLoctionStack<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>userNameNode<span class="token punctuation">,</span> postLocationNode<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            nameLoctionStack<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>userNameNode<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 声明一个水平排列的盒子</span>
        <span class="token comment">// direction: .horizontal 主轴是水平的</span>
        <span class="token comment">// spacing: 40 其子元素的间距是 40</span>
        <span class="token comment">// justifyContent: .start 在主轴上从左至右排列</span>
        <span class="token comment">// alignItems: .center 在次轴也就是垂直轴中居中</span>
        <span class="token comment">// children: [nameLoctionStack, postTimeNode] 包含的子元素</span>
        <span class="token keyword">let</span> headerStackSpec <span class="token operator">=</span> <span class="token function">ASStackLayoutSpec</span><span class="token punctuation">(</span>direction<span class="token punctuation">:</span> <span class="token punctuation">.</span>horizontal<span class="token punctuation">,</span>
                                                spacing<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                                                justifyContent<span class="token punctuation">:</span> <span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                                                alignItems<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                                                children<span class="token punctuation">:</span> <span class="token punctuation">[</span>nameLoctionStack<span class="token punctuation">,</span> postTimeNode<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">// 插入布局规则</span>
        <span class="token keyword">return</span> <span class="token function">ASInsetLayoutSpec</span><span class="token punctuation">(</span>insets<span class="token punctuation">:</span> <span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> headerStackSpec<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将示例项目从纵向转换为横向，查看间隔是如何增长和收缩的。</p> <p><strong>图像上覆盖文本</strong></p> <p><img src="/assets/img/texture-official-05.39489eb8.png" alt="img"></p> <p>要创建这个布局，我们将使用：</p> <ul><li>用于插入文本的 <code>ASInsetLayoutSpec</code> ；</li> <li>将文本覆盖到图片的 <code>ASOverlayLayoutSpec</code> ；</li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> photoDimension<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span> <span class="token operator">=</span> constrainedSize<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">4.0</span>
  photoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> photoDimension<span class="token punctuation">,</span> height<span class="token punctuation">:</span> photoDimension<span class="token punctuation">)</span>
  <span class="token comment">// CGFloat.infinity 设定 titleNode 上边距无限大</span>
  <span class="token keyword">let</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span><span class="token punctuation">.</span>infinity<span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> textInsetSpec <span class="token operator">=</span> <span class="token function">ASInsetLayoutSpec</span><span class="token punctuation">(</span>insets<span class="token punctuation">:</span> insets<span class="token punctuation">,</span> child<span class="token punctuation">:</span> titleNode<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">ASOverlayLayoutSpec</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> photoNode<span class="token punctuation">,</span> overlay<span class="token punctuation">:</span> textInsetSpec<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>图片上覆盖图标</strong></p> <p><img src="/assets/img/texture-official-06.6d5dff7e.png" alt="img"></p> <p>要创建这个布局，我们将用到：</p> <ul><li><p>设定 <code>size</code> 和 <code>position</code> 的 <code>ASLayoutable</code> 属性；</p></li> <li><p>用于放置图片和图标的  <code>ASAbsoluteLayoutSpec</code> ；</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> <span class="token punctuation">{</span>
  iconNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  iconNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>layoutPosition <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  photoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  photoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>layoutPosition <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">40</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">40</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> absoluteSpec <span class="token operator">=</span> <span class="token function">ASAbsoluteLayoutSpec</span><span class="token punctuation">(</span>children<span class="token punctuation">:</span> <span class="token punctuation">[</span>photoNode<span class="token punctuation">,</span> iconNode<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">// ASAbsoluteLayoutSpec 的 sizing 属性重新创建了 Texture Layout API 1.0 中的 ASStaticLayoutSpec</span>
  absoluteSpec<span class="token punctuation">.</span>sizing <span class="token operator">=</span> <span class="token punctuation">.</span>sizeToFit
  <span class="token keyword">return</span> absoluteSpec<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>简单的插入文本单元格</strong></p> <p><img src="/assets/img/texture-official-07.632ec1d2.png" alt="img"></p> <p>要创建一个类似 Pinterest 搜索视图的单一单元格布局，我们将用到：</p> <ul><li>用于插入文本的 <code>ASInsetLayoutSpec</code> ；</li> <li>根据指定的属性将文本居中的 <code>ASCenterLayoutSpec</code> ；</li></ul> <div class="language- extra-class"><pre class="language-text"><code>override func layoutSpecThatFits(_ constrainedSize: ASSizeRange) -&gt; ASLayoutSpec {
    let insets = UIEdgeInsets(top: 0, left: 12, bottom: 4, right: 4)
    let inset = ASInsetLayoutSpec(insets: insets, child: _titleNode)
    return ASCenterLayoutSpec(centeringOptions: .Y, sizingOptions: .minimumX, child: inset)
}
</code></pre></div><p><strong>顶部和底部的分割线</strong></p> <p><img src="data:image/png;base64,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" alt="img"></p> <p>创建一个如上的布局，我们需要用到：</p> <ul><li>用于插入文本的 <code>ASInsetLayoutSpec</code> ；</li> <li>用于在文本的顶部和底部添加分隔线，垂直的 <code>ASStackLayoutSpec</code> ；</li></ul> <p>下图展示了一个 <code>layoutables</code>是如何通过 <code>layoutSpecs</code> 和 <code>Node</code> 组成的：</p> <p><img src="/assets/img/texture-official-09.12d5ac87.png" alt="img"></p> <p>以下的代码也可以在 <code>ASLayoutSpecPlayground</code> 这个<a href="https://github.com/texturegroup/texture/tree/master/examples/LayoutSpecExamples" target="_blank" rel="noopener noreferrer">示例项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中找到。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> <span class="token punctuation">{</span>
  topSeparator<span class="token punctuation">.</span>style<span class="token punctuation">.</span>flexGrow <span class="token operator">=</span> <span class="token number">1.0</span>
  bottomSeparator<span class="token punctuation">.</span>style<span class="token punctuation">.</span>flexGrow <span class="token operator">=</span> <span class="token number">1.0</span>
  textNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>alignSelf <span class="token operator">=</span> <span class="token punctuation">.</span>center
  <span class="token keyword">let</span> verticalStackSpec <span class="token operator">=</span> <span class="token builtin">ASStackLayoutSpec</span><span class="token punctuation">.</span><span class="token function">vertical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  verticalStackSpec<span class="token punctuation">.</span>spacing <span class="token operator">=</span> <span class="token number">20</span>
  verticalStackSpec<span class="token punctuation">.</span>justifyContent <span class="token operator">=</span> <span class="token punctuation">.</span>center
  verticalStackSpec<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>topSeparator<span class="token punctuation">,</span> textNode<span class="token punctuation">,</span> bottomSeparator<span class="token punctuation">]</span>
  <span class="token keyword">return</span> <span class="token function">ASInsetLayoutSpec</span><span class="token punctuation">(</span>insets<span class="token punctuation">:</span><span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> verticalStackSpec<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="布局规则-layout-specs"><a href="#布局规则-layout-specs" aria-hidden="true" class="header-anchor">#</a> 布局规则/Layout Specs</h2> <p>以下的 <code>ASLayoutSpec</code> 子类可以用来组成简单或者非常复杂的布局：</p> <table><thead><tr><th>规则</th> <th>描述</th></tr></thead> <tbody><tr><td>ASWrapperLayoutSpec</td> <td>填充布局</td></tr> <tr><td>ASStackLayoutSpec</td> <td>盒子布局</td></tr> <tr><td>ASInsetLayoutSpec</td> <td>插入布局</td></tr> <tr><td>ASOverlayLayoutSpec</td> <td>覆盖布局</td></tr> <tr><td>ASBackgroundLayoutSpec</td> <td>背景布局</td></tr> <tr><td>ASCenterLayoutSpec</td> <td>中心布局</td></tr> <tr><td>ASRatioLayoutSpec</td> <td>比例布局</td></tr> <tr><td>ASRelativeLayoutSpec</td> <td>顶点布局</td></tr> <tr><td>ASAbsoluteLayoutSpec</td> <td>绝对布局</td></tr></tbody></table> <p>你也可以创建一个 <code>ASLayoutSpec</code> 的子类以制作自己的布局规则。</p> <p><strong>ASWrapperLayoutSpec</strong></p> <p><code>ASWrapperLayoutSpec</code> 是一个简单的 <code>ASLayoutSpec</code> 子类，它可以封装了一个 <code>LayoutElement</code>，并根据 <code>LayoutElement</code> 上设置的大小计算其布局及子元素布局。</p> <p><code>ASWrapperLayoutSpec</code> 可以轻松的从 <code>-layoutSpecThatFits:</code> 中返回一个 <code>subnode</code>。 你可以在这个 <code>subnode</code> 上设定 <code>size</code> ，但是如果你需要设定 <code>.position</code> ，请使用 <code>ASAbsoluteLayoutSpec</code> 。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// 返回一个 subnode</span>
<span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> 
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">ASWrapperLayoutSpec</span><span class="token punctuation">(</span>layoutElement<span class="token punctuation">:</span> _subnode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 设定 size，但不包括 position。</span>
<span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> 
<span class="token punctuation">{</span>
  _subnode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> constrainedSize<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>
                                        height<span class="token punctuation">:</span> constrainedSize<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">ASWrapperLayoutSpec</span><span class="token punctuation">(</span>layoutElement<span class="token punctuation">:</span> _subnode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ASStackLayoutSpec (Flexbox Container)</strong></p> <p>在 Texture 中的所有 <code>layoutSpec</code> 中，<code>ASStackLayoutSpec</code> 是最有用的，也是最强大的。  <code>ASStackLayoutSpec</code> 使用 <code>flexbox</code> 来确定其子元素的 <code>size</code> 和 <code>position</code> 。 Flexbox 旨在为不同的屏幕尺寸提供一致的布局， 在盒子布局中，你垂直或水平的对其元素。 盒子布局也可以是另一个盒子的子布局，这使得盒子布局规则几乎可以胜任任何的布局。</p> <p>除了 <code>ASLayoutElement</code> 属性，<code>ASStackLayoutSpec</code> 还有 7 个属性：</p> <ul><li><p>direction</p> <p>指定子元素的排序方向，如果设置了 <code>horizontalAlignment</code> 和 <code>verticalAlignment</code>，它们将被再次解析，这会导致 <code>justifyContent</code> 和 <code>alignItems</code> 也会相应地更新。</p></li> <li><p>spacing</p> <p>描述子元素之间的距离</p></li> <li><p>horizontalAlignment</p> <p>指定子元素如何在水平方向上对齐，它的实际效果取决于 <code>direction</code>，设置对齐会使 <code>justifyContent</code> 或 <code>alignItems</code> 更新。在 <code>direction</code> 改变之后，对齐方式仍然有效，因此，这是一个优先级高的属性。</p></li> <li><p>verticalAlignment</p> <p>指定子元素如何在垂直方向上对齐，它的实际效果取决于 <code>direction</code>，设置对齐会使 <code>justifyContent</code> 或 <code>alignItems</code> 更新。在 <code>direction</code> 改变之后，对齐方式仍然有效，因此，这是一个优先级高的属性。</p></li> <li><p>justifyContent</p> <p>描述子元素之间的距离。</p></li> <li><p>alignItems</p> <p>描述子元素在十字轴上的方向。</p></li></ul> <blockquote><p>spacing 和 justifyContent 原文都是 The amount of space between each child.</p> <p>spacing 以我的理解应该翻译的没错，但是 justifyContent 感觉不太准确，这几个属性读者可以查阅 CSS 文档自行理解。</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> 
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> mainStack <span class="token operator">=</span> <span class="token function">ASStackLayoutSpec</span><span class="token punctuation">(</span>direction<span class="token punctuation">:</span> <span class="token punctuation">.</span>horizontal<span class="token punctuation">,</span>
                                    spacing<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span>
                                    justifyContent<span class="token punctuation">:</span> <span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                                    alignItems<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>titleNode<span class="token punctuation">,</span> subtitleNode<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// 设置盒子约束大小</span>
  mainStack<span class="token punctuation">.</span>style<span class="token punctuation">.</span>minWidth <span class="token operator">=</span> <span class="token function">ASDimensionMakeWithPoints</span><span class="token punctuation">(</span><span class="token number">60.0</span><span class="token punctuation">)</span>
  mainStack<span class="token punctuation">.</span>style<span class="token punctuation">.</span>maxHeight <span class="token operator">=</span> <span class="token function">ASDimensionMakeWithPoints</span><span class="token punctuation">(</span><span class="token number">40.0</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> mainStack
<span class="token punctuation">}</span>
</code></pre></div><p>Flexbox 在 Web 上的工作方式与在 CSS 中的工作方式相同，单有一些例外。例如，默认值是不同的，没有 <code>flex</code> 参数，有关更多信息，请参阅 <a href="http://texturegroup.org/docs/layout2-web-flexbox-differences.html" target="_blank" rel="noopener noreferrer">Web Flexbox 差异<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><strong>ASInsetLayoutSpec</strong></p> <p>在布局过程中，<code>ASInsetLayoutSpec</code> 将其 <code>constrainedSize.max</code> 减去其 insets 的 <code>CGSize</code> 传递给它的子节点， 一旦子节点确定了它的 <code>size</code>，<code>insetSpec</code> 将它的最终 <code>size</code> 作为子节点的 <code>size</code> 和 <code>margin</code> 。</p> <p>由于 <code>ASInsetLayoutSpec</code> 是根据其子节点的 <code>size</code> 来确定的，因此子节点必须具有固有大小或明确设置其 <code>size</code> 。</p> <p><img src="/assets/img/texture-official-10.2011232c.png" alt="img"></p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">let</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> headerWithInset <span class="token operator">=</span> <span class="token function">ASInsetLayoutSpec</span><span class="token punctuation">(</span>insets<span class="token punctuation">:</span> insets<span class="token punctuation">,</span> child<span class="token punctuation">:</span> textNode<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果在你将 <code>UIEdgeInsets</code> 中的一个值设置为 INFINITY，则 <code>insetSpec</code> 将只使用子节点的固有大小，请看 <code>图像上覆盖文本</code> 这个例子。</p> <p><strong>ASOverlayLayoutSpec</strong></p> <p><code>ASOverlayLayoutSpec</code> 将其上面的子节点(红色)延伸，覆盖一个子节点(蓝色)。</p> <p><code>overlaySpec</code> 的 <code>size</code> 根据子节点的 <code>size</code> 计算， 在下图中，子节点是蓝色的层，然后将子节点的 <code>size</code> 作为 <code>constrainedSize</code> 传递给叠加布局元素(红色)， 因此，重要的一点是，子节点(蓝色)必须具有固有大小或明确设置 <code>size</code>。</p> <p><img src="/assets/img/texture-official-11.cd2456e0.png" alt="img"></p> <p>当使用 <code>ASOverlayLayoutSpec</code> 进行自动的子节点管理时，节点有时会表现出错误的顺序，这是一个已知的问题，并且很快就会解决。当前的解决方法是手动添加节点，布局元素(红色)必须作为子节点添加到父节点后面的子节点(蓝色)。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> backgroundNode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span>
  <span class="token keyword">let</span> foregroundNode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">ASOverlayLayoutSpec</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> backgroundNode<span class="token punctuation">,</span> overlay<span class="token punctuation">:</span> foregroundNode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ASBackgroundLayoutSpec</strong></p> <p><code>ASBackgroundLayoutSpec</code> 设置一个子节点(蓝色)为内容，将背后的另一个子节点拉伸为背景(红色)。</p> <p><code>ASBackgroundLayoutSpec</code> 的 <code>size</code> 根据子节点的 <code>size</code> 确定，在下图中，子节点是蓝色层，子节点的 <code>size</code> 作为 <code>constrainedSize</code> 传递给背景图层(红色)，因此重要的一点是，子节点(蓝色)必须有一个固有大小或明确设置 <code>size</code>。</p> <p><img src="/assets/img/texture-official-12.ce4e9902.png" alt="img"></p> <p>当使用 <code>ASOverlayLayoutSpec</code> 进行自动的子节点管理时，节点有时会表现出错误的顺序，这是一个已知的问题，并且很快就会解决。当前的解决方法是手动添加节点，布局元素(蓝色)必须作为子节点添加到父节点后面的子节点(红色)。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> backgroundNode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span>
  <span class="token keyword">let</span> foregroundNode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">ASBackgroundLayoutSpec</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> foregroundNode<span class="token punctuation">,</span> background<span class="token punctuation">:</span> backgroundNode<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意：添加子节点的顺序对于这个布局规则是很重要的。 背景对象必须在前台对象之前作为子节点添加到父节点，目前使用 ASM 不能保证这个顺序一定是正确的！</strong></p> <p><strong>ASCenterLayoutSpec</strong></p> <p><code>ASCenterLayoutSpec</code> 将其子节点的中心设置为最大的 <code>constrainedSize</code> 的中心。</p> <p><img src="/assets/img/texture-official-13.69fb4339.png" alt="img"></p> <p>如果 <code>ASCenterLayoutSpec</code> 的宽度或高度没有设定约束，那么它会缩放到和子节点的宽度或高度一致。</p> <p><code>ASCenterLayoutSpec</code> 有两个属性：</p> <ul><li><p>centeringOptions：</p> <p>决定子节点如何在 <code>ASCenterLayoutSpec</code> 中居中，可选值包括：None，X，Y，XY。</p></li> <li><p>sizingOptions：</p> <p>决定 <code>ASCenterLayoutSpec</code> 占用多少空间，可选值包括：Default，minimum X，minimum Y，minimum XY。</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> subnode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>green<span class="token punctuation">,</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">60.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> centerSpec <span class="token operator">=</span> <span class="token function">ASCenterLayoutSpec</span><span class="token punctuation">(</span>centeringOptions<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token constant">XY</span><span class="token punctuation">,</span> sizingOptions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> subnode<span class="token punctuation">)</span>
  <span class="token keyword">return</span> centerSpec
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ASRatioLayoutSpec</strong></p> <p><code>ASRatioLayoutSpec</code> 可以以固定的宽高比来缩放子节点。 这个规则必须将一个宽度或高度传递给它作为一个 <code>constrainedSize</code>，因为它使用这个值来进行计算。</p> <p><img src="/assets/img/texture-official-14.6b1b5e2a.png" alt="img"></p> <p>使用 <code>ASRatioLayoutSpec</code> 为 <code>ASNetworkImageNode</code> 或 <code>ASVideoNode</code> 提供固有大小是非常常见的，因为两者在内容从服务器返回之前都没有固有大小。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 将 subnode 缩放一半</span>
  <span class="token keyword">let</span> subnode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>green<span class="token punctuation">,</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> ratioSpec <span class="token operator">=</span> <span class="token function">ASRatioLayoutSpec</span><span class="token punctuation">(</span>ratio<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> subnode<span class="token punctuation">)</span>
  <span class="token keyword">return</span> ratioSpec
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ASRelativeLayoutSpec</strong></p> <p>根据水平位置和垂直位置的设定，将一个子节点放置在九宫格布局规则中的任意位置。</p> <p>这是一个非常强大的布局规则，但是它非常复杂，在这个概述中无法逐一阐述， 有关更多信息，请参阅 <code>ASRelativeLayoutSpec</code> 的 <code>-calculateLayoutThatFits:</code> 方法和属性。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">let</span> backgroundNode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span>
  <span class="token keyword">let</span> foregroundNode <span class="token operator">=</span> <span class="token function">ASDisplayNodeWithBackgroundColor</span><span class="token punctuation">(</span><span class="token builtin">UIColor</span><span class="token punctuation">.</span>red<span class="token punctuation">,</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">70.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> relativeSpec <span class="token operator">=</span> <span class="token function">ASRelativeLayoutSpec</span><span class="token punctuation">(</span>horizontalPosition<span class="token punctuation">:</span> <span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                                          verticalPosition<span class="token punctuation">:</span> <span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                                          sizingOption<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                          child<span class="token punctuation">:</span> foregroundNode<span class="token punctuation">)</span>

  <span class="token keyword">let</span> backgroundSpec <span class="token operator">=</span> <span class="token function">ASBackgroundLayoutSpec</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> relativeSpec<span class="token punctuation">,</span> background<span class="token punctuation">:</span> backgroundNode<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ASAbsoluteLayoutSpec</strong></p> <p><code>ASAbsoluteLayoutSpec</code> 中你可以通过设置它们的 <code>layoutPosition</code> 属性来指定其子节点的横纵坐标。 绝对布局比其他类型的布局相比，不太灵活且难以维护。</p> <p><code>ASAbsoluteLayoutSpec</code> 有一个属性：</p> <ul><li><p>sizing：</p> <p>确定 <code>ASAbsoluteLayoutSpec</code> 将占用多少空间，可选值包括：Default，Size to Fit。请注意，Size to Fit 将复制旧的 <code>ASStaticLayoutSpec</code> 的行为。</p></li></ul> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> maxConstrainedSize <span class="token operator">=</span> constrainedSize<span class="token punctuation">.</span><span class="token builtin">max</span>

  <span class="token comment">// 在一个静态布局中,使用 ASAbsoluteLayoutSpec 布局所有子节点</span>
  guitarVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>layoutPosition <span class="token operator">=</span> <span class="token builtin">CGPoint</span><span class="token punctuation">.</span>zero
  guitarVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>width<span class="token punctuation">,</span> height<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span>

  nicCageVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>layoutPosition <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span>
  nicCageVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span>

  simonVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>layoutPosition <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token punctuation">(</span>maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  simonVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span>

  hlsVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>layoutPosition <span class="token operator">=</span> <span class="token function">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span>
  hlsVideoNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredSize <span class="token operator">=</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> maxConstrainedSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token function">ASAbsoluteLayoutSpec</span><span class="token punctuation">(</span>children<span class="token punctuation">:</span> <span class="token punctuation">[</span>guitarVideoNode<span class="token punctuation">,</span> nicCageVideoNode<span class="token punctuation">,</span> simonVideoNode<span class="token punctuation">,</span> hlsVideoNode<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ASLayoutSpec</strong></p> <p><code>ASLayoutSpec</code> 是所有布局规则的父类，它的主要工作是处理和管理所有的子类，它也可以用来创建自定义的布局规则。不过创建 <code>ASLayoutSpec</code> 的自定义子类是一项 <code>super advanced</code> 级别的操作，如果你有这方面的需要，建议你尝试将我们提供的布局规则进行组合，以创建更高级的布局。</p> <p><code>ASLayoutSpec</code> 的另一个用途是应用了 <code>.flexShrink</code> 或者 <code>.flexGrow</code> 是，在 <code>ASStackLayoutSpec</code> 中作为一个 <code>spacer</code> 和其他子节点一起使用，</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">let</span> spacer <span class="token operator">=</span> <span class="token function">ASLayoutSpec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  spacer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>flexGrow <span class="token operator">=</span> <span class="token number">1.0</span>

  stack<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>imageNode<span class="token punctuation">,</span> spacer<span class="token punctuation">,</span> textNode<span class="token punctuation">]</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="布局元素属性-layout-element-properties"><a href="#布局元素属性-layout-element-properties" aria-hidden="true" class="header-anchor">#</a> 布局元素属性/Layout Element Properties</h2> <ul><li>ASStackLayoutElement Properties：只会在盒子布局中的的 <code>subnode</code> 或 <code>layoutSpec</code> 中生效；</li> <li>ASAbsoluteLayoutElement Properties：只会在绝对布局中的的 <code>subnode</code> 或 <code>layoutSpec</code> 中生效；</li> <li>ASLayoutElement Properties：适用于所有 <code>Node</code> 和 <code>layoutSpec</code>；</li></ul> <p>####ASStackLayoutElement Properties</p> <p><strong>请注意，以下属性只有在 ASStackLayout 的 subnode上设置才会生效。</strong></p> <p><strong>.style.spacingBefore</strong></p> <p><code>CGFloat</code> 类型，direction 上与前一个 node 的间隔。</p> <p><strong>.style.spacingAfter</strong></p> <p><code>CGFloat</code> 类型，direction 上与后一个 node 的间隔。</p> <p><strong>.style.flexGrow</strong></p> <p><code>Bool</code> 类型，子节点尺寸总和小于 minimum ，即存在剩余空间时，是否放大。</p> <p><strong>.style.flexShrink</strong></p> <p><code>Bool</code> 类型，子节点总和大于 maximum，即空间不足时，是否缩小。</p> <p><strong>.style.flexBasis</strong></p> <p><code>ASDimension</code> 类型，描述在剩余空间是均分的情况下，应用 <code>flexGrow</code> 或 <code>flexShrink</code> 属性之前，该对象在盒子中垂直或水平方向的初始 <code>size</code>，</p> <p><strong>.style.alignSelf</strong></p> <p><code>ASStackLayoutAlignSelf</code> 类型，描述对象在十字轴的方向，此属性会覆盖 <code>alignItems</code>，可选值有：</p> <ul><li><code>ASStackLayoutAlignSelfAuto</code></li> <li><code>ASStackLayoutAlignSelfStart</code></li> <li><code>ASStackLayoutAlignSelfEnd</code></li> <li><code>ASStackLayoutAlignSelfCenter</code></li> <li><code>ASStackLayoutAlignSelfStretch</code></li></ul> <p><strong>.style.ascender</strong></p> <p><code>CGFloat</code> 类型，用于基线对齐，描述对象从顶部到其基线的距离。</p> <p><strong>.style.descender</strong></p> <p><code>CGFloat</code> 类型，用于基线对齐，描述对象从基线到其底部的距离。</p> <p>####ASAbsoluteLayoutElement Properties</p> <p><strong>请注意，以下属性只有在 AbsoluteLayout 的 subnode上设置才会生效。</strong></p> <p><strong>.style.layoutPosition</strong></p> <p><code>CGPoint</code> 类型，描述该对象在 <code>ASAbsoluteLayoutSpec</code> 父规则中的位置。</p> <h3 id="aslayoutelement-properties"><a href="#aslayoutelement-properties" aria-hidden="true" class="header-anchor">#</a> ASLayoutElement Properties</h3> <p><strong>请注意，以下属性适用于所有布局元素。</strong></p> <h4 id="style-width"><a href="#style-width" aria-hidden="true" class="header-anchor">#</a> .style.width</h4> <p><code>ASDimension</code> 类型，<code>width</code> 属性描述了 <code>ASLayoutElement</code> 内容区域的宽度。 <code>minWidth</code> 和 <code>maxWidth</code> 属性会覆盖 <code>width</code>， 默认值为 <code>ASDimensionAuto</code>。</p> <p><strong>.style.height</strong></p> <p><code>ASDimension</code> 类型，<code>height</code> 属性描述了 <code>ASLayoutElement</code> 内容区域的高度。 <code>minHeight</code> 和 <code>maxHeight</code> 属性会覆盖 <code>height</code>，默认值为 <code>ASDimensionAuto</code>。</p> <p><strong>.style.minWidth</strong></p> <p><code>ASDimension</code> 类型，<code>minWidth</code> 属性用于设置一个特定布局元素的最小宽度。 它可以防止 <code>width</code> 属性的使用值小于 <code>minWidth</code> 指定的值，<code>minWidth</code> 的值会覆盖 <code>maxWidth</code> 和 <code>width</code>。 默认值为 <code>ASDimensionAuto</code>。</p> <p><strong>.style.maxWidth</strong></p> <p><code>ASDimension</code> 类型，<code>maxWidth</code> 属性用于设置一个特定布局元素的最大宽度。 它可以防止 <code>width</code> 属性的使用值大于 <code>maxWidth</code> 指定的值，<code>maxWidth</code> 的值会覆盖 <code>width</code>，<code>minWidth</code> 会覆盖 <code>maxWidth</code>。 默认值为 <code>ASDimensionAuto</code>。</p> <p><strong>.style.minHeight</strong></p> <p><code>ASDimension</code> 类型，<code>minHeight</code> 属性用于设置一个特定布局元素的最小高度。 它可以防止 <code>height</code> 属性的使用值小于 <code>minHeight</code> 指定的值。 <code>minHeight</code> 的值会覆盖 <code>maxHeight</code> 和 <code>height</code>。 默认值为 <code>ASDimensionAuto</code>。</p> <p><strong>.style.maxHeight</strong></p> <p><code>ASDimension</code> 类型，<code>maxHeight</code> 属性用于设置一个特定布局元素的最大高度，它可以防止 <code>height</code> 属性的使用值大于 <code>maxHeight</code> 指定的值。 <code>maxHeight</code> 的值会覆盖 <code>height</code>，<code>minHeight</code> 会覆盖 <code>maxHeight</code>。 默认值为 <code>ASDimensionAuto</code>。</p> <p><strong>.style.preferredSize</strong></p> <p><code>CGSize</code> 类型， 建议布局元素的 <code>size</code> 应该是多少。 如果提供了 <code>minSize</code> 或 <code>maxSize</code> ，并且 <code>preferredSize</code> 超过了这些值，则强制使用 <code>minSize</code> 或 <code>maxSize</code>。 如果未提供 <code>preferredSize</code>，则布局元素的 <code>size</code> 默认为 <code>calculateSizeThatFits:</code> 方法提供的固有大小。</p> <p>此方法是可选的，但是对于没有固有大小或需要用与固有大小不同的的 size 进行布局的节点，则必须指定 <code>preferredSize</code> 或 <code>preferredLayoutSize</code> 中的一个，比如没这个属性可以在 <code>ASImageNode</code> 上设置，使这个节点的 <code>size</code> 和图片 <code>size</code> 不同。</p> <p><strong>警告：当 size 的宽度或高度是相对值时调用 getter 将进行断言。</strong></p> <p><strong>.style.minSize</strong></p> <p><code>CGSize</code> 类型，可选属性，为布局元素提供最小尺寸，如果提供，<code>minSize</code> 将会强制使用。 如果父级布局元素的 <code>minSize</code> 小于其子级的 <code>minSize</code>，则强制使用子级的 <code>minSize</code>，并且其大小将扩展到布局规则之外。</p> <p>例如，如果给全屏容器中的某个元素设置 50％ 的 <code>preferredSize</code> 相对宽度，和 200pt 的 <code>minSize</code> 宽度，<code>preferredSize</code> 会在 iPhone 屏幕上产生 160pt 的宽度，但由于 160pt 低于 200pt 的 <code>minSize</code> 宽度，因此最终该元素的宽度会是 200pt。</p> <p><strong>.style.maxSize</strong></p> <p><code>CGSize</code> 类型，可选属性，为布局元素提供最大尺寸，如果提供，<code>maxSize</code> 将会强制使用。 如果子布局元素的 <code>maxSize</code> 小于其父级的 <code>maxSize</code>，则强制使用子级的 <code>maxSize</code>，并且其大小将扩展到布局规则之外。</p> <p>例如，如果给全屏容器中的某个元素设置 50％ 的 <code>preferredSize</code> 相对宽度，和 120pt 的 <code>maxSize</code> 宽度，<code>preferredSize</code> 会在 iPhone 屏幕上产生 160pt 的宽度，但由于 160pt 高于 120pt 的 <code>maxSize</code> 宽度，因此最终该元素的宽度会是 120pt。</p> <p><strong>.style.preferredLayoutSize</strong></p> <p><code>ASLayoutSize</code> 类型，为布局元素提供建议的相对 <code>size</code>。 <code>ASLayoutSize</code> 使用百分比而不是点来指定布局。 例如，子布局元素的宽度应该是父宽度的 50％。 如果提供了可选的 <code>minLayoutSize</code> 或 <code>maxLayoutSize</code>，并且 <code>preferredLayoutSize</code> 超过了这些值，则将使用 <code>minLayoutSize</code> 或 <code>maxLayoutSize</code>。 如果未提供此可选值，则布局元素的 <code>size</code> 将默认是 <code>calculateSizeThatFits:</code> 提供的固有大小。</p> <p><strong>.style.minLayoutSize</strong></p> <p><code>ASLayoutSize</code> 类型， 可选属性，为布局元素提供最小的相对尺寸， 如果提供，<code>minLayoutSize</code> 将会强制使用。 如果父级布局元素的 <code>minLayoutSize</code> 小于其子级的 <code>minLayoutSize</code>，则会强制使用子级的 <code>minLayoutSize</code>，并且其大小将扩展到布局规则之外。</p> <p><strong>.style.maxLayoutSize</strong></p> <p><code>ASLayoutSize</code> 类型， 可选属性，为布局元素提供最大的相对尺寸。 如果提供，<code>maxLayoutSize</code> 将会强制使用。 如果父级布局元素的 <code>maxLayoutSize</code> 小于其子级的 <code>maxLayoutSize</code>，那么将强制使用子级的 <code>maxLayoutSize</code>，并且其大小将扩展到布局规则之外。</p> <p>####Layout API Sizing</p> <p>理解 Layout API 的各种类型最简单方法是查看所有单位之间的相互关系。</p> <p><img src="/assets/img/texture-official-15.33f822c8.png" alt="img"></p> <p><strong>ASDimension</strong></p> <p><code>ASDimension</code> 基本上是一个正常的 <code>CGFloat</code>，支持表示一个 pt 值，一个相对百分比值或一个自动值，这个单位允许一个的 API 同时使用固定值和相对值。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token comment">// 返回一个相对值</span>
<span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>
<span class="token function">ASDimensionMakeWithFraction</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>

<span class="token comment">// 返回一个 pt 值</span>
<span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;70pt&quot;</span><span class="token punctuation">)</span>
<span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">)</span>
<span class="token function">ASDimensionMakeWithPoints</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">)</span>
</code></pre></div><p>使用 <code>ASDimension</code> 的示例：</p> <p><code>ASDimension</code>用于设置 <code>ASStackLayoutSpec</code> 子元素的 <code>flexBasis</code> 属性。 <code>flexBasis</code> 属性根据在盒子排序方向是水平还是垂直，来指定对象的初始大小。在下面的视图中，我们希望左边的盒子占据水平宽度的 40％，右边的盒子占据宽度的 60％，这个效果我们可以通过在水平盒子容器的两个 <code>childen</code> 上设置 <code>.flexBasis</code> 属性来实现：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">self</span><span class="token punctuation">.</span>leftStack<span class="token punctuation">.</span>style<span class="token punctuation">.</span>flexBasis <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;40%&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">self</span><span class="token punctuation">.</span>rightStack<span class="token punctuation">.</span>style<span class="token punctuation">.</span>flexBasis <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;60%&quot;</span><span class="token punctuation">)</span>
horizontalStack<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>leftStack<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>rightStack<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p><strong>CGSize/ASLayoutSize</strong></p> <p><code>ASLayoutSize</code> 类似于 <code>CGSize</code>，但是它的<strong>宽度和高度可以同时使用 pt 值或百分比值</strong>。 宽度和高度的类型是独立的，它们的值类型可以不同。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token function">ASLayoutSizeMake</span><span class="token punctuation">(</span><span class="token number">_</span> width<span class="token punctuation">:</span> <span class="token builtin">ASDimension</span><span class="token punctuation">,</span> <span class="token number">_</span> height<span class="token punctuation">:</span> <span class="token builtin">ASDimension</span><span class="token punctuation">)</span>
</code></pre></div><p><code>ASLayoutSize</code> 用于描述布局元素的 <code>.preferredLayoutSize</code>，<code>.minLayoutSize</code> 和 <code>.maxLayoutSize</code> 属性，它允许在一个 API 中同时使用固定值和相对值。</p> <p><strong>ASDimensionMake</strong></p> <p><code>ASDimension</code> 类型 <code>auto</code> 表示布局元素可以根据情况选择最合理的方式。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token punctuation">.</span>auto<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>

layoutElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>preferredLayoutSize <span class="token operator">=</span> <span class="token function">ASLayoutSizeMake</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
</code></pre></div><p>你也可以使用固定值设置布局元素的 <code>.preferredSize</code>、<code>.minSize</code>、<code>.maxSize</code> 属性。</p> <div class="language- extra-class"><pre class="language-text"><code>layoutElement.style.preferredSize = CGSize(width: 30, height: 60)
</code></pre></div><p>大多数情况下，你不需要要限制宽度和高度。如果你需要，可以使用 <code>ASDimension</code> 值单独设置布局元素的 <code>size</code> 属性：</p> <div class="language-swift extra-class"><pre class="language-swift"><code>layoutElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width     <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>
layoutElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>minWidth  <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>
layoutElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>maxWidth  <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>

layoutElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height    <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>
layoutElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>minHeight <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>
layoutElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>maxHeight <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token string">&quot;50%&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>ASSizeRange</strong></p> <p><code>UIKit</code> 没有提供一个机制绑定最小和最大的 <code>CGSize</code>，因此，为了支持最小和最大的 <code>CGSize</code>，我们创建了 <code>ASSizeRange</code>， <code>ASSizeRange</code> 主要应用在 Llayout API 的内部，但是 <code>layoutSpecThatFits:</code> 方法的的输入参数 <code>constrainedSize</code> 是 <code>ASSizeRange</code> 类型。</p> <div class="language- extra-class"><pre class="language-text"><code>func layoutSpecThatFits(_ constrainedSize: ASSizeRange) -&gt; ASLayoutSpec复制代码
</code></pre></div><p>传递给 <code>ASDisplayNode</code> 子类 <code>layoutSpecThatFits:</code> 方法的 <code>constrainedSize</code> 是 <code>Node</code> 最适合的最小和最大尺寸，你可以在布局元素上使用 <code>constrainedSize</code> 中包含的最小和最大 <code>CGSize</code> 。</p> <h2 id="layout-transition-api"><a href="#layout-transition-api" aria-hidden="true" class="header-anchor">#</a> Layout Transition API</h2> <p>Layout Transition API 旨在让所有的 Texture 动画都变得简单 - 甚至可以将一个视图集转为另一个完全不同的视图集！</p> <p>使用这个系统，你只需指定所需的布局，Texture 会根据当前的布局自动找出差异，它会自动添加新的元素，动画结束后自动删除不需要的元素，并更新现有的元素的位置。</p> <p>同时也有非常容易使用的 API，让你可以完全自定义一个新元素的起始位置，以及移除元素的结束位置。</p> <p><strong>使用 Layout Transition API 必须使用自动子节点管理功能。</strong></p> <p><strong>布局之间的动画</strong></p> <p>Layout Transition API 使得在使用 <code>node</code> 制作的布局中，在 <code>node</code> 的内部状态更改时，可以很容易地进行动画操作。</p> <p>想象一下，你希望实现这个注册的表单，并且在点击 <code>Next</code> 时出现新的输入框的动画：</p> <p><img src="/assets/img/texture-official-16.97bced19.gif" alt="img"></p> <p>实现这一点的标准方法是创建一个名为 <code>SignupNode</code> 的容器节点，<code>SignupNode</code> 包含两个可编辑的 <code>text field node</code> 和一个 <code>button node</code> 作为子节点。 我们将在 <code>SignupNode</code> 上包含一个名为 <code>fieldState</code> 的属性，该属性用于当计算布局时，要显示哪个 <code>text field node</code>。</p> <p><code>SignupNode</code> 容器的内部 <code>layoutSpec</code> 看起来是这样的：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">layoutSpecThatFits</span><span class="token punctuation">(</span><span class="token number">_</span> constrainedSize<span class="token punctuation">:</span> <span class="token builtin">ASSizeRange</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">ASLayoutSpec</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> fieldNode<span class="token punctuation">:</span> <span class="token builtin">FieldNode</span>

  <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>fieldState <span class="token operator">==</span> <span class="token punctuation">.</span>signupNodeName <span class="token punctuation">{</span>
      fieldNode <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>nameField
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      fieldNode <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>ageField
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token function">ASStackLayoutSpec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  stack<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>fieldNode<span class="token punctuation">,</span> buttonNode<span class="token punctuation">]</span>

  <span class="token keyword">let</span> insets <span class="token operator">=</span> <span class="token function">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">ASInsetLayoutSpec</span><span class="token punctuation">(</span>insets<span class="token punctuation">:</span> insets<span class="token punctuation">,</span> child<span class="token punctuation">:</span> stack<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为了在本例中触发从 <code>nameField</code> 到 <code>ageField</code> 的转换，我们将更新 <code>SignupNode</code> 的 <code>.fieldState</code> 属性，并使用 <code>transitionLayoutWithAnimation</code> 方法触发动画。</p> <p>这个方法将使当前计算的布局失效，并重新计算 <code>ageField</code> 在盒子中的布局。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">self</span><span class="token punctuation">.</span>signupNode<span class="token punctuation">.</span>fieldState <span class="token operator">=</span> <span class="token punctuation">.</span>signupNodeName
<span class="token keyword">self</span><span class="token punctuation">.</span>signupNode<span class="token punctuation">.</span><span class="token function">transitionLayout</span><span class="token punctuation">(</span>withAnimation<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> shouldMeasureAsync<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre></div><p>在这个 API 的默认实现中，布局将重新计算，并使用它的 <code>sublayouts</code> 来对 <code>SignupNode</code> 子节点的 <code>size</code> 和  <code>position</code> 进行设置，但没有动画。这个 API 的未来版本很可能会包括布局之间的默认动画，有关你希望在此处看到的内容，我们欢迎你进行反馈，但是，现在我们需要实现一个自定义动画块来处理这个动画。</p> <p>下面的示例表示在 <code>SignupNode</code> 中的 <code>animateLayoutTransition:</code> 的重写。</p> <p>这个方法在通过 <code>transitionLayoutWithAnimation:</code> 计算出新布局之后调用，在实现中，我们将根据动画触发前设置的 <code>fieldState</code> 属性执行特定的动画。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">animateLayoutTransition</span><span class="token punctuation">(</span><span class="token number">_</span> context<span class="token punctuation">:</span> <span class="token builtin">ASContextTransitioning</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> fieldState <span class="token operator">==</span> <span class="token punctuation">.</span>signupNodeName <span class="token punctuation">{</span>
    <span class="token keyword">let</span> initialNameFrame <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">initialFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> ageField<span class="token punctuation">)</span>

    nameField<span class="token punctuation">.</span>frame <span class="token operator">=</span> initialNameFrame
    nameField<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">var</span> finalAgeFrame <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">finalFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> nameField<span class="token punctuation">)</span>
    finalAgeFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x <span class="token operator">-</span><span class="token operator">=</span> finalAgeFrame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width

    <span class="token builtin">UIView</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>withDuration<span class="token punctuation">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span> animations<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
        <span class="token keyword">self</span><span class="token punctuation">.</span>nameField<span class="token punctuation">.</span>frame <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">finalFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>nameField<span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>nameField<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>ageField<span class="token punctuation">.</span>frame <span class="token operator">=</span> finalAgeFrame
        <span class="token keyword">self</span><span class="token punctuation">.</span>ageField<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token punctuation">{</span> finished <span class="token keyword">in</span>
        context<span class="token punctuation">.</span><span class="token function">completeTransition</span><span class="token punctuation">(</span>finished<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> initialAgeFrame <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">initialFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> nameField<span class="token punctuation">)</span>
    initialAgeFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> initialAgeFrame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width

    ageField<span class="token punctuation">.</span>frame <span class="token operator">=</span> initialAgeFrame
    ageField<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">var</span> finalNameFrame <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">finalFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> ageField<span class="token punctuation">)</span>
    finalNameFrame<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>x <span class="token operator">-</span><span class="token operator">=</span> finalNameFrame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width

    <span class="token builtin">UIView</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>withDuration<span class="token punctuation">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span> animations<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
        <span class="token keyword">self</span><span class="token punctuation">.</span>ageField<span class="token punctuation">.</span>frame <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">finalFrame</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>ageField<span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>ageField<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>nameField<span class="token punctuation">.</span>frame <span class="token operator">=</span> finalNameFrame
        <span class="token keyword">self</span><span class="token punctuation">.</span>nameField<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token punctuation">{</span> finished <span class="token keyword">in</span>
        context<span class="token punctuation">.</span><span class="token function">completeTransition</span><span class="token punctuation">(</span>finished<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此方法中传递的 <code>ASContextTransitioning</code> 上下文对象包含相关信息，可以帮助你确定转换前后的节点状态。它包括新旧约束大小，插入和删除的节点，甚至是新旧 <code>ASLayout</code> 原始对象。在 <code>SignupNode</code> 示例中，我们使用它来确定每个节点的 <code>frame</code> 并在一个地方让它们进动画。</p> <p>一旦动画完成，就必须调用上下文对象的 <code>completeTransition:</code>，因为它将为新布局内部执行必要的步骤，以使新布局生效。</p> <p>请注意，在这个过程中没有使用 <code>addSubnode:</code> 或 <code>removeFromSupernode:</code>。 Layout Transition API 会分析旧布局和新布局之间节点层次结构的差异，通过<a href="http://texturegroup.org/docs/automatic-subnode-mgmt.html" target="_blank" rel="noopener noreferrer">自动子节点管理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>隐式的执行节点插入和删除。</p> <p>在执行 <code>animateLayoutTransition:</code> 之前插入节点，这是在开始动画之前手动管理层次结构的好地方。在上下文对象执行 <code>completeTransition :</code>之后，清除将在 <code>didCompleteLayoutTransition:</code> 中执行。</p> <p>如果你需要手动执行删除，请重写 <code>didCompleteLayoutTransition:</code> 并执行自定义的操作。需要注意的是，这样做会覆盖默认删除行为，建议你调用 <code>super</code> 或遍历上下文对象中的 <code>removedSubnodes</code> 来执行清理。</p> <p>将 <code>NO</code> 传递给 <code>transitionLayoutWithAnimation:</code> 将贯穿 <code>animateLayoutTransition:</code> 和 <code>didCompleteLayoutTransition:</code> 的执行，并将 <code>[context isAnimated]</code> 属性设置为 <code>NO</code>。如何处理这样的情况取决于你的选择 - 如果有的话。提供默认实现的一种简单方法是调用 <code>super</code> :</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">animateLayoutTransition</span><span class="token punctuation">(</span><span class="token number">_</span> context<span class="token punctuation">:</span> <span class="token builtin">ASContextTransitioning</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> context<span class="token punctuation">.</span><span class="token function">isAnimated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">animateLayoutTransition</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>动画 constrainedSize 更改</strong></p> <p>有些时候，你只想对节点的 <code>bounds</code> 变化作出响应，重新计算其布局。这种情况，可以在节点上调用 <code>transitionLayoutWithSizeRange:animated:</code>。</p> <p>该方法类似于 <code>transitionLayoutWithAnimation:</code>，但是如果传递的 <code>ASSizeRange</code> 等于当前的 <code>constrainedSizeForCalculatedLayout</code>，则不会触发动画。 这在响应旋转事件和控制器 <code>size</code> 发生变化时非常有用。</p> <p><strong>使用 Layout Transition API 的示例</strong></p> <ul><li><a href="https://github.com/texturegroup/texture/tree/master/examples/ASDKLayoutTransition" target="_blank" rel="noopener noreferrer">ASDKLayoutTransition<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/source/swift/Texture-official-concept.html" class="prev">
          Texture 基本概念
        </a></span> <span class="next"><a href="/source/swift/UIScrollView-touch-conflict.html">
          UIScrollView嵌套滚动解决手势冲突
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.27fa633f.js" defer></script><script src="/assets/js/5.1d8544f7.js" defer></script>
  </body>
</html>
