<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Swift 5 中使用原始字符串 | Jovins Blog</title>
    <meta name="description" content="Work Hard, Play Hard">
    <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa6af71c.css" as="style"><link rel="preload" href="/assets/js/app.6bb9da5a.js" as="script"><link rel="preload" href="/assets/js/98.e6b65e90.js" as="script"><link rel="prefetch" href="/assets/js/10.4d662145.js"><link rel="prefetch" href="/assets/js/100.f7e53abc.js"><link rel="prefetch" href="/assets/js/101.3e575f24.js"><link rel="prefetch" href="/assets/js/102.05d0cb55.js"><link rel="prefetch" href="/assets/js/103.0d949667.js"><link rel="prefetch" href="/assets/js/104.48eceb14.js"><link rel="prefetch" href="/assets/js/105.6e7e087b.js"><link rel="prefetch" href="/assets/js/106.40a8ff92.js"><link rel="prefetch" href="/assets/js/107.a08dfbf5.js"><link rel="prefetch" href="/assets/js/108.75be99a0.js"><link rel="prefetch" href="/assets/js/109.018ccd61.js"><link rel="prefetch" href="/assets/js/11.861d6f21.js"><link rel="prefetch" href="/assets/js/110.ca8a954a.js"><link rel="prefetch" href="/assets/js/12.79427878.js"><link rel="prefetch" href="/assets/js/13.df8371fd.js"><link rel="prefetch" href="/assets/js/14.da13c95b.js"><link rel="prefetch" href="/assets/js/15.d05aedc4.js"><link rel="prefetch" href="/assets/js/16.6131b99a.js"><link rel="prefetch" href="/assets/js/17.decd6fa3.js"><link rel="prefetch" href="/assets/js/18.ca4ef511.js"><link rel="prefetch" href="/assets/js/19.cafde05f.js"><link rel="prefetch" href="/assets/js/2.300f03cf.js"><link rel="prefetch" href="/assets/js/20.dac1ab91.js"><link rel="prefetch" href="/assets/js/21.7285b95c.js"><link rel="prefetch" href="/assets/js/22.91a1295a.js"><link rel="prefetch" href="/assets/js/23.17a53cc3.js"><link rel="prefetch" href="/assets/js/24.36f1e672.js"><link rel="prefetch" href="/assets/js/25.c6e50ac1.js"><link rel="prefetch" href="/assets/js/26.4ee6bbee.js"><link rel="prefetch" href="/assets/js/27.dfe6afa1.js"><link rel="prefetch" href="/assets/js/28.1a301a2a.js"><link rel="prefetch" href="/assets/js/29.77edb257.js"><link rel="prefetch" href="/assets/js/3.61494192.js"><link rel="prefetch" href="/assets/js/30.5d7a36f7.js"><link rel="prefetch" href="/assets/js/31.08b97173.js"><link rel="prefetch" href="/assets/js/32.d9342bdc.js"><link rel="prefetch" href="/assets/js/33.d9e28ba6.js"><link rel="prefetch" href="/assets/js/34.c6956af2.js"><link rel="prefetch" href="/assets/js/35.7d811e08.js"><link rel="prefetch" href="/assets/js/36.9e928afc.js"><link rel="prefetch" href="/assets/js/37.8194678f.js"><link rel="prefetch" href="/assets/js/38.49e01c9f.js"><link rel="prefetch" href="/assets/js/39.3027daab.js"><link rel="prefetch" href="/assets/js/4.747323b8.js"><link rel="prefetch" href="/assets/js/40.6b5023a0.js"><link rel="prefetch" href="/assets/js/41.b7828274.js"><link rel="prefetch" href="/assets/js/42.fb6f2dd4.js"><link rel="prefetch" href="/assets/js/43.c211a3fe.js"><link rel="prefetch" href="/assets/js/44.9c85e2c8.js"><link rel="prefetch" href="/assets/js/45.44c265d9.js"><link rel="prefetch" href="/assets/js/46.ef51b4e4.js"><link rel="prefetch" href="/assets/js/47.092de074.js"><link rel="prefetch" href="/assets/js/48.3c73fc2c.js"><link rel="prefetch" href="/assets/js/49.46b56ffc.js"><link rel="prefetch" href="/assets/js/5.a07d1f19.js"><link rel="prefetch" href="/assets/js/50.22860da8.js"><link rel="prefetch" href="/assets/js/51.70600c02.js"><link rel="prefetch" href="/assets/js/52.096eef02.js"><link rel="prefetch" href="/assets/js/53.a34cc3b4.js"><link rel="prefetch" href="/assets/js/54.72be83eb.js"><link rel="prefetch" href="/assets/js/55.41dad318.js"><link rel="prefetch" href="/assets/js/56.f41fd90e.js"><link rel="prefetch" href="/assets/js/57.d9cfffe6.js"><link rel="prefetch" href="/assets/js/58.78032fee.js"><link rel="prefetch" href="/assets/js/59.49a89cb4.js"><link rel="prefetch" href="/assets/js/6.6816146d.js"><link rel="prefetch" href="/assets/js/60.9dcac23a.js"><link rel="prefetch" href="/assets/js/61.7e4f476d.js"><link rel="prefetch" href="/assets/js/62.cd6806d3.js"><link rel="prefetch" href="/assets/js/63.9f7199ef.js"><link rel="prefetch" href="/assets/js/64.7e9d799e.js"><link rel="prefetch" href="/assets/js/65.0a1ec7b5.js"><link rel="prefetch" href="/assets/js/66.8d65db7c.js"><link rel="prefetch" href="/assets/js/67.5baf1947.js"><link rel="prefetch" href="/assets/js/68.5a5a556b.js"><link rel="prefetch" href="/assets/js/69.7a4a8963.js"><link rel="prefetch" href="/assets/js/7.282dd4dd.js"><link rel="prefetch" href="/assets/js/70.4b777e60.js"><link rel="prefetch" href="/assets/js/71.dcab3040.js"><link rel="prefetch" href="/assets/js/72.4e224eff.js"><link rel="prefetch" href="/assets/js/73.04088244.js"><link rel="prefetch" href="/assets/js/74.6a87c314.js"><link rel="prefetch" href="/assets/js/75.37d41c0d.js"><link rel="prefetch" href="/assets/js/76.f77db92f.js"><link rel="prefetch" href="/assets/js/77.32df4a4f.js"><link rel="prefetch" href="/assets/js/78.8868e49e.js"><link rel="prefetch" href="/assets/js/79.4f9afe08.js"><link rel="prefetch" href="/assets/js/8.bf179d57.js"><link rel="prefetch" href="/assets/js/80.cc43f89f.js"><link rel="prefetch" href="/assets/js/81.5cea0707.js"><link rel="prefetch" href="/assets/js/82.f554dcec.js"><link rel="prefetch" href="/assets/js/83.43f18d25.js"><link rel="prefetch" href="/assets/js/84.57a0a4c3.js"><link rel="prefetch" href="/assets/js/85.262f6146.js"><link rel="prefetch" href="/assets/js/86.1d79804b.js"><link rel="prefetch" href="/assets/js/87.8c7f42bf.js"><link rel="prefetch" href="/assets/js/88.2ffa98e3.js"><link rel="prefetch" href="/assets/js/89.4ae3f3bd.js"><link rel="prefetch" href="/assets/js/9.eaa65c84.js"><link rel="prefetch" href="/assets/js/90.7b69f098.js"><link rel="prefetch" href="/assets/js/91.b940a237.js"><link rel="prefetch" href="/assets/js/92.7403d9a0.js"><link rel="prefetch" href="/assets/js/93.31a5e51e.js"><link rel="prefetch" href="/assets/js/94.d4c7e313.js"><link rel="prefetch" href="/assets/js/95.d928d532.js"><link rel="prefetch" href="/assets/js/96.7a2ed927.js"><link rel="prefetch" href="/assets/js/97.af9e5d20.js"><link rel="prefetch" href="/assets/js/99.06fafc20.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa6af71c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jovins Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source/swift/" class="nav-link router-link-active">Swift</a></div><div class="nav-item"><a href="/source/swiftui/" class="nav-link">SwiftUI</a></div><div class="nav-item"><a href="/source/summary/" class="nav-link">Summary</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source/swift/" class="nav-link router-link-active">Swift</a></div><div class="nav-item"><a href="/source/swiftui/" class="nav-link">SwiftUI</a></div><div class="nav-item"><a href="/source/summary/" class="nav-link">Summary</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Swift 文章</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/source/swift/" class="sidebar-link">Swift可选类型Optional的用法</a></li><li><a href="/source/swift/RxSwift-5.0.html" class="sidebar-link">RxSwift 5.0 内容更新</a></li><li><a href="/source/swift/Swift-ABI.html" class="sidebar-link">Swift ABI 稳定后的几个问题</a></li><li><a href="/source/swift/Swift-5-original-String.html" class="active sidebar-link">Swift 5 中使用原始字符串</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source/swift/Swift-5-original-String.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/source/swift/Swift-5-original-String.html#什么是原始字符串？" class="sidebar-link">什么是原始字符串？</a></li><li class="sidebar-sub-header"><a href="/source/swift/Swift-5-original-String.html#使用分隔符" class="sidebar-link">使用分隔符</a></li><li class="sidebar-sub-header"><a href="/source/swift/Swift-5-original-String.html#为什么原始字符串有用？" class="sidebar-link">为什么原始字符串有用？</a></li></ul></li><li><a href="/source/swift/swift5-newfuture.html" class="sidebar-link">Swift 5 新特性</a></li><li><a href="/source/swift/Swift-String-Substring.html" class="sidebar-link">Swift中String和Substring</a></li><li><a href="/source/swift/Swift-defer.html" class="sidebar-link">Swift defer 的正确使用</a></li><li><a href="/source/swift/result-types.html" class="sidebar-link">泛型Opaque Result Types</a></li><li><a href="/source/swift/xcode10-2.html" class="sidebar-link">Xcode 10.2</a></li><li><a href="/source/swift/vapor.html" class="sidebar-link">Swift Vapor学习</a></li><li><a href="/source/swift/Swift-4-Codable.html" class="sidebar-link">Swift 4 Codable 协议</a></li><li><a href="/source/swift/Swift-Tuple-inout.html" class="sidebar-link">元组Tuple和其关键字inout</a></li><li><a href="/source/swift/Swift-Protocol.html" class="sidebar-link">Swift 协议 protocol</a></li><li><a href="/source/swift/Swift-Moya-design.html" class="sidebar-link">Moya框架设计浅谈</a></li><li><a href="/source/swift/Swift-Error.html" class="sidebar-link">Swift Error 的分类</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>OpenGL/OpenGL ES</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="swift-5-中使用原始字符串"><a href="#swift-5-中使用原始字符串" aria-hidden="true" class="header-anchor">#</a> Swift 5 中使用原始字符串</h1> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>Swift 5 中的<code>原始字符串(raw string)</code>让我们能够编写出更自然的字符串，尤其是在使用<code>反斜杠</code>和<code>引号</code>时。正如将在下面看到的那样，在某些情况下效果是很明显的，如正则表达式。</p> <p>我之前在 <code>What’s new in Swift 5.0</code> 一文中介绍了 Swift 5 中的所有新功能，甚至还有一个专门用于<a href="https://www.whatsnewinswift.com" target="_blank" rel="noopener noreferrer">跟踪 Swift 最新功能的网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在本文中我想谈谈如何在 Swift 5 中使用原始字符串，同时还提供了一些有用的详细示例，以便更清楚地了解它们的用处。</p> <p>如果你曾经问过自己“Swift 中的那些带标签 <code>#</code> 的字符串是什么？” 的话，你应该能在这篇文章中找到答案！</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>提示：原始字符串是完全可选的 - 重要的是你至少知道它们是什么，这样你就可以在某段代码中看到它们时知道这是什么，而不一定需要在你自己的代码中使用它们。</p></div> <h2 id="什么是原始字符串？"><a href="#什么是原始字符串？" aria-hidden="true" class="header-anchor">#</a> 什么是原始字符串？</h2> <p>在 Swift 5 中，我们能够使用 <code>#</code> 符号来指定自定义字符串的分割符。 当我们使用带 <code>#</code> 的字符串时，它会影响到 Swift 解析字符串中特殊字符的方式：<code>\</code> 不再作为转义字符，所以 <code>\n</code> 字面意思是反斜杠跟着 <code>“n”</code> 而不是换行符，而 <code>\(variable)</code> 不再表示字符串插值，而是实实在在的字符串。</p> <p>这样，以下两个字符串是相同的：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> regularString <span class="token operator">=</span> <span class="token string">&quot;\\Hello \\World&quot;</span>
<span class="token keyword">let</span> rawString <span class="token operator">=</span> #<span class="token string">&quot;\Hello \World&quot;</span>#
</code></pre></div><p>请注意，在第二个示例中，字符串以 <code>#</code> 开头和结尾，这标志着它是一个原始字符串。</p> <p>现在可以在字符串内使用相同的 <code>#</code> 符号，用于标记特殊字符。例如，如果要使用字符串插值，现在应该使用 <code>\#(variableName)</code> 而不是 <code>\(variableName)</code>，如下所示：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;Taylor&quot;</span>
<span class="token keyword">let</span> greeting <span class="token operator">=</span> #<span class="token string">&quot;Hello, \#(name)!&quot;</span>#
<span class="token function">print</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span>
</code></pre></div><p>我们也可以将 <code>#</code> 与多行字符串一起使用，如下所示：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> message <span class="token operator">=</span> #<span class="token string">&quot;&quot;</span>&quot;
<span class="token builtin">This</span> <span class="token keyword">is</span> rendered <span class="token keyword">as</span> text<span class="token punctuation">:</span> \<span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token builtin">This</span> uses string interpolation<span class="token punctuation">:</span> \#<span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token string">&quot;&quot;</span>&quot;#
</code></pre></div><h2 id="使用分隔符"><a href="#使用分隔符" aria-hidden="true" class="header-anchor">#</a> 使用分隔符</h2> <p>虽然这是理论上应该永远不需要的功能，但可以在字符串周围添加更多 <code>#</code>，以创建更多的唯一的字符串分隔符。</p> <p>例如，以下这些都创建相同的字符串：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> zero <span class="token operator">=</span> <span class="token string">&quot;This is a string&quot;</span>
<span class="token keyword">let</span> one <span class="token operator">=</span> #<span class="token string">&quot;This is a string&quot;</span>#
<span class="token keyword">let</span> two <span class="token operator">=</span> ##<span class="token string">&quot;This is a string&quot;</span>##
<span class="token keyword">let</span> three <span class="token operator">=</span> ###<span class="token string">&quot;This is a string&quot;</span>###
<span class="token keyword">let</span> four <span class="token operator">=</span> ####<span class="token string">&quot;This is a string&quot;</span>####
</code></pre></div><p>这种情况存在的原因是我们想根据自己的需要来结束字符串，这样当你需要在字符串中使用 <code>&quot;#</code> 这种比较少的情形时，也不会遇到问题。</p> <p>应该强调的是，这种情况非常少见。例如，你想写一个字符串，如 <code>My dog said &quot;woof&quot;#gooddog</code> -- 注意在 <code>&quot;woof&quot;</code> 后面没有空格，后面直接跟了一个 Twitter 风格的标签 <code>#gooddog</code>。如果只使用单个分割符的原始字符串，Swift 会将 <code>#gooddog</code> 中的 <code>#</code> 视为结束符，所以我们需要如下处理：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> str <span class="token operator">=</span> ##<span class="token string">&quot;My dog said &quot;</span>woof<span class="token string">&quot;#gooddog&quot;</span>##
</code></pre></div><h2 id="为什么原始字符串有用？"><a href="#为什么原始字符串有用？" aria-hidden="true" class="header-anchor">#</a> 为什么原始字符串有用？</h2> <p>Swift Evolution 在原始字符串的 proposal 中列出了三个使用原始字符串的例子。具体来说，是以下情形的代码：</p> <ul><li>被转义掩盖了。转义会损害代码审查和验证。</li> <li>已经转义了。转义的内容不应由编译器预先解释。</li> <li>无论是为了测试还是仅更新源，都需要在源和代码之间轻松传输。</li></ul> <p>前两个是最有可能影响你的：向已经转义的字符串添加转义通常会使代码更难以阅读。</p> <p>作为一个例子，让我们来看看正则表达式。假设我们有一个像这样的字符串：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> message <span class="token operator">=</span> #<span class="token string">&quot;String interpolation looks like this: <span class="token interpolation"><span class="token delimiter variable">\(</span>age<span class="token delimiter variable">)</span></span>.&quot;</span>#
</code></pre></div><p>这里使用原始字符串来展示字符串插值的语义而不是实际使用它 - 字符串 <code>(age)</code> 将出现在文本中，而不是被 <code>age</code> 的实际值替换。</p> <p>如果我们想要创建一个正则表达式来查找所有字符串插值，我们将以 <code>\([^)])</code> 开头。这表示着“反斜杠，左括号，一个或多个不是右括号的字符，然后是右括号。（如果你还没有使用达正则表达式，建议看下 <a href="https://www.hackingwithswift.com/store/beyond-code" target="_blank" rel="noopener noreferrer">Beyond Code 这本书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>但是，我们不能在 Swift 中使用它 - 因为这是无效的：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> regex <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">NSRegularExpression</span><span class="token punctuation">(</span>pattern<span class="token punctuation">:</span> <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token delimiter variable">)</span></span>])&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>Swift将 <code>\</code> 视为转义字符，并假定我们正在尝试在正则表达式中使用字符串插值。所以，我们需要两个反斜杠来做转义，如下所示：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> regex <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">NSRegularExpression</span><span class="token punctuation">(</span>pattern<span class="token punctuation">:</span> <span class="token string">&quot;\<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token delimiter variable">)</span></span>]+)&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>But now there’s a second problem: when that string reaches the regex system it will be read as ([^)]), so the regex system will assume we’re escaping the opening parenthesis as opposed to typing a literal backslash, so we need to add another escape for the regex system:</p> <p>但现在又有第二个问题：当正则表达式系统处理该字符串时，会将 <code>\([^]])</code> 作为输入，因此正则表达式系统将假设我们正在转义左括号而不是将 <code>\</code> 当作文本处理，所以我们需要为正则表达式系统添加另一个转义：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> regex <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">NSRegularExpression</span><span class="token punctuation">(</span>pattern<span class="token punctuation">:</span> <span class="token string">&quot;\\<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token delimiter variable">)</span></span>]+)&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>而这时 Swift 又会抱怨，因为它认为我们要同时转义反斜杠并括号，所以我们需要第四个反斜杠：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> regex <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">NSRegularExpression</span><span class="token punctuation">(</span>pattern<span class="token punctuation">:</span> <span class="token string">&quot;\\\<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token delimiter variable">)</span></span>]+)&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>是的，现在有四个反斜杠：一个是我们想要匹配的，一个是在 Swift 中用于转义的，一个是在正则表达式引擎中用于转义的，另一个是转义正在使用 Swift 中的一个正则表达式引擎（太绕）。</p> <p>然而这个正则表达式仍然无法正常使用。</p> <p>你看，我们还需要转义我们想要匹配的左括号和右括号，这意味着完整的正则表达式是这样的：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> regex <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">NSRegularExpression</span><span class="token punctuation">(</span>pattern<span class="token punctuation">:</span> <span class="token string">&quot;\\\\\<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token delimiter variable">)</span></span>]+\\)&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>请记住，我们在正则表达式引擎中添加 <code>\</code> 以转义 <code>(</code> ，同时在 Swift 中也要添加了一个 <code>\</code> 以转义正则表达式的引用。</p> <p>如果我们使用原始字符串，我们仍然需要转义正则表达式引擎的字符：为了匹配 <code>\</code> 我们必须写 <code>\</code>，为了匹配 <code>(</code> 我们必须写 <code>(</code>。但是，至少我们不再需要为Swift添加额外的转义字符。</p> <p>所以，我们最终只需要一半的 <code>\</code>：</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> regex <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">NSRegularExpression</span><span class="token punctuation">(</span>pattern<span class="token punctuation">:</span> #<span class="token string">&quot;\\<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token delimiter variable">)</span></span>]+\)&quot;</span>#<span class="token punctuation">)</span>
</code></pre></div><p>该正则表达式模式没有 Swift 独有的转义，因此您可以在 <a href="https://regex101.com" target="_blank" rel="noopener noreferrer">regex101.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 等网站上试用它而无需修改。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/source/swift/Swift-ABI.html" class="prev">
          Swift ABI 稳定后的几个问题
        </a></span> <span class="next"><a href="/source/swift/swift5-newfuture.html">
          Swift 5 新特性
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.6bb9da5a.js" defer></script><script src="/assets/js/98.e6b65e90.js" defer></script>
  </body>
</html>
