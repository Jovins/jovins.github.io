<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序适配 iPhone X 总结 | Jovins Blog</title>
    <meta name="description" content="Work Hard, Play Hard">
    <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa6af71c.css" as="style"><link rel="preload" href="/assets/js/app.45c2c56b.js" as="script"><link rel="preload" href="/assets/js/84.665f41fb.js" as="script"><link rel="prefetch" href="/assets/js/10.99bbcf46.js"><link rel="prefetch" href="/assets/js/100.4ff47055.js"><link rel="prefetch" href="/assets/js/101.255075f9.js"><link rel="prefetch" href="/assets/js/102.5506cbf3.js"><link rel="prefetch" href="/assets/js/103.590b1952.js"><link rel="prefetch" href="/assets/js/104.16511586.js"><link rel="prefetch" href="/assets/js/11.6995aa03.js"><link rel="prefetch" href="/assets/js/12.d1aeb970.js"><link rel="prefetch" href="/assets/js/13.3808cbb9.js"><link rel="prefetch" href="/assets/js/14.05c65f0c.js"><link rel="prefetch" href="/assets/js/15.79469dcd.js"><link rel="prefetch" href="/assets/js/16.bcec1f4f.js"><link rel="prefetch" href="/assets/js/17.1bac9075.js"><link rel="prefetch" href="/assets/js/18.e3c3b169.js"><link rel="prefetch" href="/assets/js/19.516ccfe4.js"><link rel="prefetch" href="/assets/js/2.abd15c4d.js"><link rel="prefetch" href="/assets/js/20.06f0bcf7.js"><link rel="prefetch" href="/assets/js/21.fe872b4e.js"><link rel="prefetch" href="/assets/js/22.28c254f2.js"><link rel="prefetch" href="/assets/js/23.a835c06c.js"><link rel="prefetch" href="/assets/js/24.3f7228c2.js"><link rel="prefetch" href="/assets/js/25.ac51f988.js"><link rel="prefetch" href="/assets/js/26.b59abae2.js"><link rel="prefetch" href="/assets/js/27.cd3c6c96.js"><link rel="prefetch" href="/assets/js/28.c940ab72.js"><link rel="prefetch" href="/assets/js/29.a359f46e.js"><link rel="prefetch" href="/assets/js/3.eab54b8c.js"><link rel="prefetch" href="/assets/js/30.a11cef84.js"><link rel="prefetch" href="/assets/js/31.e00708c5.js"><link rel="prefetch" href="/assets/js/32.fc57bd53.js"><link rel="prefetch" href="/assets/js/33.a0c36fb1.js"><link rel="prefetch" href="/assets/js/34.ba2e8263.js"><link rel="prefetch" href="/assets/js/35.4e677282.js"><link rel="prefetch" href="/assets/js/36.9606378b.js"><link rel="prefetch" href="/assets/js/37.29b1b26c.js"><link rel="prefetch" href="/assets/js/38.5f2d7b00.js"><link rel="prefetch" href="/assets/js/39.2034fe59.js"><link rel="prefetch" href="/assets/js/4.0dcb83ea.js"><link rel="prefetch" href="/assets/js/40.0149e03c.js"><link rel="prefetch" href="/assets/js/41.09709ee1.js"><link rel="prefetch" href="/assets/js/42.83a36ad7.js"><link rel="prefetch" href="/assets/js/43.4096bb7c.js"><link rel="prefetch" href="/assets/js/44.68a45e4d.js"><link rel="prefetch" href="/assets/js/45.b0d66d41.js"><link rel="prefetch" href="/assets/js/46.54afe46e.js"><link rel="prefetch" href="/assets/js/47.47d0eb4d.js"><link rel="prefetch" href="/assets/js/48.1b1231f9.js"><link rel="prefetch" href="/assets/js/49.8891071c.js"><link rel="prefetch" href="/assets/js/5.20de59e0.js"><link rel="prefetch" href="/assets/js/50.8b0c47c5.js"><link rel="prefetch" href="/assets/js/51.edbcfa00.js"><link rel="prefetch" href="/assets/js/52.9ef337fb.js"><link rel="prefetch" href="/assets/js/53.57cc5779.js"><link rel="prefetch" href="/assets/js/54.575a8bf2.js"><link rel="prefetch" href="/assets/js/55.fa196cbe.js"><link rel="prefetch" href="/assets/js/56.6af43272.js"><link rel="prefetch" href="/assets/js/57.aeaaa632.js"><link rel="prefetch" href="/assets/js/58.d6493831.js"><link rel="prefetch" href="/assets/js/59.13098fb5.js"><link rel="prefetch" href="/assets/js/6.fa56a93f.js"><link rel="prefetch" href="/assets/js/60.3456b434.js"><link rel="prefetch" href="/assets/js/61.3fc7e8c5.js"><link rel="prefetch" href="/assets/js/62.93eb848a.js"><link rel="prefetch" href="/assets/js/63.d3552b8b.js"><link rel="prefetch" href="/assets/js/64.1e43c6b6.js"><link rel="prefetch" href="/assets/js/65.e502d646.js"><link rel="prefetch" href="/assets/js/66.3993e150.js"><link rel="prefetch" href="/assets/js/67.a2d6fc18.js"><link rel="prefetch" href="/assets/js/68.8347a1a2.js"><link rel="prefetch" href="/assets/js/69.d5c60e32.js"><link rel="prefetch" href="/assets/js/7.4718466c.js"><link rel="prefetch" href="/assets/js/70.455b6ca3.js"><link rel="prefetch" href="/assets/js/71.7f1e655e.js"><link rel="prefetch" href="/assets/js/72.5d9dad22.js"><link rel="prefetch" href="/assets/js/73.20f8b883.js"><link rel="prefetch" href="/assets/js/74.e3b904c7.js"><link rel="prefetch" href="/assets/js/75.86230303.js"><link rel="prefetch" href="/assets/js/76.6fcdc539.js"><link rel="prefetch" href="/assets/js/77.5f0e2e7e.js"><link rel="prefetch" href="/assets/js/78.f417d583.js"><link rel="prefetch" href="/assets/js/79.e7ab9a2e.js"><link rel="prefetch" href="/assets/js/8.4c8a9f6d.js"><link rel="prefetch" href="/assets/js/80.1ca3e07c.js"><link rel="prefetch" href="/assets/js/81.26dc6004.js"><link rel="prefetch" href="/assets/js/82.82667bbe.js"><link rel="prefetch" href="/assets/js/83.f028cd44.js"><link rel="prefetch" href="/assets/js/85.b7a023b4.js"><link rel="prefetch" href="/assets/js/86.3234dd2f.js"><link rel="prefetch" href="/assets/js/87.759f890b.js"><link rel="prefetch" href="/assets/js/88.1b1d06b6.js"><link rel="prefetch" href="/assets/js/89.c13dfa3e.js"><link rel="prefetch" href="/assets/js/9.40dc386c.js"><link rel="prefetch" href="/assets/js/90.df5e8ccd.js"><link rel="prefetch" href="/assets/js/91.585aec72.js"><link rel="prefetch" href="/assets/js/92.b5ef35df.js"><link rel="prefetch" href="/assets/js/93.5789889e.js"><link rel="prefetch" href="/assets/js/94.3d7cdfde.js"><link rel="prefetch" href="/assets/js/95.2327a099.js"><link rel="prefetch" href="/assets/js/96.8c9401b9.js"><link rel="prefetch" href="/assets/js/97.376abc62.js"><link rel="prefetch" href="/assets/js/98.a7355130.js"><link rel="prefetch" href="/assets/js/99.5363e2ff.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa6af71c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jovins Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source/swift/" class="nav-link">Swift</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link router-link-exact-active router-link-active">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source/swift/" class="nav-link">Swift</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link router-link-exact-active router-link-active">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>小程序</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/source/program/" class="active sidebar-link">小程序适配 iPhone X 总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source/program/#iphone-x-屏幕数据" class="sidebar-link">iPhone X 屏幕数据</a></li><li class="sidebar-sub-header"><a href="/source/program/#小程序的尺寸单位" class="sidebar-link">小程序的尺寸单位</a></li><li class="sidebar-sub-header"><a href="/source/program/#小程序中如何判断设备为-iphone-x" class="sidebar-link">小程序中如何判断设备为 iPhone X</a></li><li class="sidebar-sub-header"><a href="/source/program/#页面适配实战" class="sidebar-link">页面适配实战</a></li><li class="sidebar-sub-header"><a href="/source/program/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/source/program/#相关链接" class="sidebar-link">相关链接</a></li></ul></li><li><a href="/source/program/miniprogram-sync.html" class="sidebar-link">小程序多页面数据同步</a></li><li><a href="/source/program/miniprogram-explore.html" class="sidebar-link">小程序多端框架测评</a></li><li><a href="/source/program/miniprogram-reporter.html" class="sidebar-link">小程序代码小记</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="小程序适配-iphone-x-总结"><a href="#小程序适配-iphone-x-总结" aria-hidden="true" class="header-anchor">#</a> 小程序适配 iPhone X 总结</h1> <p>小程序在适配 iPhone X 屏幕时遇到的一些问题以及总结，希望对你的小程序开发能有所帮助。</p> <h2 id="iphone-x-屏幕数据"><a href="#iphone-x-屏幕数据" aria-hidden="true" class="header-anchor">#</a> iPhone X 屏幕数据</h2> <p>在去年 2017 年份 iPhone X 正式发布后，引发了一波 iOS App 适配 iPhone X 的热潮和技术文章。</p> <p>我们这里先简单总结一下 iPhone X 屏幕的基础数据，方便后续在小程序开发中进行适配。</p> <ul><li>屏幕尺寸：5.8 英寸（对角线）</li> <li>屏幕物理分辨率：1125px × 2436px，458 ppi</li> <li>实际开发适配尺寸：375pt × 812pt，@3x</li></ul> <p>此外，由于在 iPhone X 屏幕顶部状态栏区域有“齐刘海”，以及在屏幕底部增加了“操作条”，如下图所示，因此，我们在开发中需要注意<strong>安全区域</strong>的问题。</p> <p>根据苹果官方的文档，iPhone X 顶部状态栏的适配安全区域的高度为 44pt，底部操作条区域的高度为 34pt。另外，在 iPhone X 中，一些系统 Bar 的默认高度相比于之前的设备也发生了变化，如下表所示。</p> <table><thead><tr><th style="text-align:left">Item</th> <th>Normal Height</th> <th style="text-align:center">iPhoneX Height</th></tr></thead> <tbody><tr><td style="text-align:left">UINavigationBar</td> <td>44 pt</td> <td style="text-align:center">44 pt(96 pt large title)</td></tr> <tr><td style="text-align:left">UIStatusBar</td> <td>20 pt</td> <td style="text-align:center">44 pt</td></tr> <tr><td style="text-align:left">UINavigationBar + UIStatusBar</td> <td>64 pt</td> <td style="text-align:center">88 pt</td></tr> <tr><td style="text-align:left">UITabBar</td> <td>49 pt</td> <td style="text-align:center">83 pt</td></tr> <tr><td style="text-align:left">UIToolBar</td> <td>44 pt</td> <td style="text-align:center">83 pt</td></tr></tbody></table> <p>所以在 iOS App 开发中，如果我们使用系统默认的 <code>UINavigationController</code> 和 <code>UITabBarController</code> 时，则无需额外的适配工作，iOS 系统会自动适配好相关 Bar 的安全区域问题。如果我们使用了自定义的导航栏和标签栏，则需要注意根据设备类型区分设置这些 Bar 的不同高度。</p> <h2 id="小程序的尺寸单位"><a href="#小程序的尺寸单位" aria-hidden="true" class="header-anchor">#</a> 小程序的尺寸单位</h2> <p>为了解决不同屏幕尺寸的适配问题，小程序自己定了一个尺寸单位：rpx（responsive pixel），它可以根据屏幕宽度进行自适应。小程序中规定，<strong>所有设备的屏幕宽度都为 750rpx</strong>，根据设备屏幕实际宽度的不同，1rpx 所代表的实际像素值也不一样。</p> <p>根据微信开发文档，在 4.7 英寸的 iPhone 设备上（iPhone 6/7/8），屏幕宽度为 375px（此处应该理解为 375 point），共有 750 个物理像素，则 750rpx = 375px = 750 物理像素，1rpx = 0.5px = 1物理像素。</p> <table><thead><tr><th>设备</th> <th style="text-align:center">Rpx换算px(屏幕宽度/750)</th> <th style="text-align:right">px换算rpx (750/屏幕宽度)</th></tr></thead> <tbody><tr><td>iPhone 5</td> <td style="text-align:center">1rpx = 0.42px</td> <td style="text-align:right">1px = 2.34px</td></tr> <tr><td>iPhone 6</td> <td style="text-align:center">1rpx = 0.5px</td> <td style="text-align:right">1px = 2rpx</td></tr> <tr><td>iPhone 6 Plus</td> <td style="text-align:center">1rpx = 0.552px</td> <td style="text-align:right">1px = 1.81px</td></tr></tbody></table> <h2 id="小程序中如何判断设备为-iphone-x"><a href="#小程序中如何判断设备为-iphone-x" aria-hidden="true" class="header-anchor">#</a> 小程序中如何判断设备为 iPhone X</h2> <p>上面我们简要介绍了 iPhone X 的屏幕数据和小程序中的尺寸单位作为铺垫，现在终于要切入正题了，要在小程序中适配 iPhone X 屏幕，首先我们需要知道如何判断设备类型。</p> <p>微信的小程序 API 中提供了一个 <code>wx.getSystemInfo(OBJECT)</code> 方法用于获取用户手机的系统信息和设备信息，包含如下数据：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object <span class="token punctuation">{</span> <span class="token string">&quot;errMsg&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;getSystemInfo&quot;</span><span class="token punctuation">,</span>
		SDKVersion<span class="token punctuation">:</span> <span class="token string">&quot;2.20&quot;</span><span class="token punctuation">,</span>
  	batteryLevel<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    errMsg<span class="token punctuation">:</span> <span class="token string">&quot;getSystemInfo:ok&quot;</span><span class="token punctuation">,</span>
    fontSizeSetting<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
    language<span class="token punctuation">:</span> <span class="token string">&quot;zh_CN&quot;</span><span class="token punctuation">,</span>
    model<span class="token punctuation">:</span> <span class="token string">&quot;iPhone X(GSM+CDMA)&lt;iPhone10,3&gt;&quot;</span><span class="token punctuation">,</span>
    pixelRatio<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    platform<span class="token punctuation">:</span> <span class="token string">&quot;iOS&quot;</span><span class="token punctuation">,</span>
    screenHeight<span class="token punctuation">:</span> <span class="token number">812</span><span class="token punctuation">,</span>
    screenWidth<span class="token punctuation">:</span> <span class="token number">375</span><span class="token punctuation">,</span>
    statusBarHeight<span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span>
    system<span class="token punctuation">:</span> <span class="token string">&quot;iOS 11.4.1&quot;</span><span class="token punctuation">,</span>
    version<span class="token punctuation">:</span> <span class="token string">&quot;6.7.1&quot;</span><span class="token punctuation">,</span>
    windowHeight<span class="token punctuation">:</span> <span class="token number">642</span><span class="token punctuation">,</span>
    windowWidth<span class="token punctuation">:</span> <span class="token number">375</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>__proto__<span class="token punctuation">:</span> Object
</code></pre></div><p>上述每个字段的含义详见微信文档.</p> <p>因此，我们可以根据该方法返回的手机型号字段 <code>model</code> 是否包含 <code>iPhone X</code> 字符串来判断设备是否为 iPhone X，也可以根据 <code>screenHeight</code> 的高度是否等于 <code>812</code> 来判断。</p> <p><strong>NOTE:</strong> 这里有一个小坑需要注意，在微信开发者工具中的模拟器，如果选择为 iPhone X，此时获取到的 <code>model</code> 值为 <code>iPhone X</code>，导致我以为真机也是这个值，于是直接用 <code>if (model == 'iPhone X')</code> 来判断，但其实真机下 <code>model</code> 的值为这种格式： <code>iPhone X (GSM+CDMA)&lt;iPhone10,3&gt;</code>，因此我们需要用字符串检索匹配进行判断。</p> <p>综上，我们可以在 <code>app.js</code>  的 <code>globalData</code> 中添加一个字段 <code>isIPX</code> 用于标识当前设备是否为 iPhone X，然后在小程序启动时 <code>onLaunch</code> 中调用 <code>wx.getSystemInfo(OBJECT)</code> 方法并在其 <code>success</code> 回调中读取 <code>model</code> 字段进行分析，代码大致如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 全局数据</span>
  globalData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他数据定义 ...</span>

    isIPX<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 当前设备是否为 iPhone X</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 小程序启动入口</span>
  <span class="token function-variable function">onLaunch</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他启动代码...</span>

    <span class="token comment">// 判断设备是否为 iPhone X</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIsIPhoneX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">checkIsIPhoneX</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span>
    wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 根据 model 进行判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token string">'iPhone X'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          self<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>isIPX <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 或者根据 screenHeight 进行判断</span>
        <span class="token comment">// if (res.screenHeight == 812) {</span>
        <span class="token comment">//   self.globalData.isIPX = true</span>
        <span class="token comment">// }</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果需要小程序启动时立即获取设备相关信息，也可以调 <code>wx.getSystemInfoSync()</code> 方法，它会同步获取数据并立即返回。</p> <h2 id="页面适配实战"><a href="#页面适配实战" aria-hidden="true" class="header-anchor">#</a> 页面适配实战</h2> <p>在小程序页面开发中，涉及到需要适配 iPhone X 的地方主要有：导航栏（NavigationBar），标签栏（TabBar）以及页面底部的吸底按钮。</p> <ul><li>导航栏和标签栏适配</li></ul> <p>如果我们使用微信小程序官方组件进行开发，没有进行自定义，在 <code>app.json</code> 文件中设置 <code>tabBar</code> 页面，且 <code>window</code> 的 <code>navigationStyle</code> 值为 <code>default</code>，那么我们无需在 iPhone X 中对导航栏和标签栏进行适配，微信会自动帮我们适配好.</p> <p>但是我们如果是自定义导航栏（在 <code>app.json</code> 文件中设置 <code>window</code> 的 <code>navigationStyle</code> 为 <code>custom</code>，此时只保留右上角胶囊状的按钮，需要开发者自己画导航栏样式）和标签栏，则我们需要在每个页面中判断设备类型，并针对 iPhone X 屏幕在安全区域内进行布局，并修改相关 Bar 的高度值（见上述表格）。</p> <p>以自定义导航栏适配为例，步骤如下：</p> <p>（1）在每个页面的 <code>page.js</code> 中先读取 <code>app.js</code> 中的 <code>isIPX</code> 值，如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 页面其他数据...</span>
    isIPX<span class="token punctuation">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>isIPX<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 其他代码</span>
<span class="token punctuation">}</span>
</code></pre></div><p>（2）然后在 <code>page.wxss</code> 样式文件中对某一个视图 <code>View</code> 分别为普通屏幕和 iPhone X 屏幕写两种样式，如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">.</span>navi<span class="token operator">-</span>bar<span class="token operator">-</span>view <span class="token punctuation">{</span>
  height<span class="token punctuation">:</span> <span class="token number">64</span>px<span class="token punctuation">;</span>
  <span class="token comment">/* 其他样式值 */</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>navi<span class="token operator">-</span>bar<span class="token operator">-</span>view<span class="token operator">-</span><span class="token constant">IPX</span> <span class="token punctuation">{</span>
  height<span class="token punctuation">:</span> <span class="token number">88</span>px<span class="token punctuation">;</span>
  <span class="token comment">/* 其他样式值 */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>（3）最后在 <code>page.wxml</code> 页面结构布局中根据 <code>isIPX</code> 的值给 <code>View</code> 设置不同的 <code>class</code> 样式，如下：</p> <div class="language-css extra-class"><pre class="language-css"><code>&lt;view class=<span class="token selector">&quot;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>isIPX ? <span class="token string">'navi-bar-view-IPX'</span> <span class="token punctuation">:</span> <span class="token string">'navi-bar-view'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>&quot;&gt;
&lt;/view&gt;
</code></pre></div><p>此外，对于自定义导航栏和标签栏，我建议还是要遵循 iPhone UI 的设计规范，样式我们可以参考苹果官方的渲染图。</p> <ul><li>吸底按钮适配</li></ul> <p>在小程序页面中，吸底按钮是很常见的一种设计，我们一般会把一些重要的按钮放在页面底部悬浮不动。</p> <p>在 iPhone X 中我们需要把吸底按钮往上偏移 34 像素，可通过在 CSS 样式中设置 <code>padding-bottom</code> 为 <code>34px</code> 实现，参考代码如下：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.feed-bottom-view</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span> <span class="token comment">/* 吸底按钮的高度 */</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0.95<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">border-top-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span>
  <span class="token property">border-top-width</span><span class="token punctuation">:</span> 0.5px<span class="token punctuation">;</span> <span class="token comment">/* 分割线的高度 */</span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> lightgrey<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #F8F8F8<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.feed-bottom-view-IPX</span> <span class="token punctuation">{</span>
  <span class="token comment">/* iPhone X 内容往上偏移 34px */</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 34px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code>&lt;view class=<span class="token selector">&quot;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>isIPX ? <span class="token string">'feed-bottom-view feed-bottom-view-IPX'</span> <span class="token punctuation">:</span> <span class="token string">'feed-bottom-view'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>&quot;&gt;
&lt;!-- 底部吸底按区域 --&gt;
&lt;/view&gt;
</code></pre></div><p>**备注：**如前面所述，对于不同设备宽度，1rpx 所代表的实际像素值也不一样，而在不同尺寸的 iPhone 设备（3.5/4.0/4.7/5.5 英寸）中，虽然它们的宽度不同，但其导航栏+状态栏的高度都为 64pt（iPhone X 为 88pt），标签栏 TabBar 的高度都为 49pt（iPhone X 为 83pt）。所以在小程序开发中，当我们需要自定义导航栏、标签栏，或者适配 iPhone X 顶部和底部安全区域时，我建议此处的单位直接使用 <code>px</code>（在小程序中对应 iOS 开发中的点 <code>pt</code>）而不使用 <code>rpx</code>（当然页面的其他元素的尺寸描述还是推荐使用 <code>rpx</code>），以确保最终渲染显示的高度与 iOS 系统默认的一致。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>本文简要介绍了在小程序开发中如何适配 iPhone X 屏幕.</p> <h2 id="相关链接"><a href="#相关链接" aria-hidden="true" class="header-anchor">#</a> 相关链接</h2> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/wx.getSystemInfo.html" target="_blank" rel="noopener noreferrer">微信开发文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/systeminfo.html#wxgetsysteminfoobject" target="_blank" rel="noopener noreferrer">iPhone X 适配实践<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/source/program/miniprogram-sync.html">
          小程序多页面数据同步
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.45c2c56b.js" defer></script><script src="/assets/js/84.665f41fb.js" defer></script>
  </body>
</html>
