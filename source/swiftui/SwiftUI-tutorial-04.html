<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SwiftUI 官方教程四: 处理用户输入 | Jovins Blog</title>
    <meta name="description" content="Work Hard, Play Hard">
    <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa6af71c.css" as="style"><link rel="preload" href="/assets/js/app.ad555431.js" as="script"><link rel="preload" href="/assets/js/10.5630b3d6.js" as="script"><link rel="prefetch" href="/assets/js/100.e06a3107.js"><link rel="prefetch" href="/assets/js/101.4efe755c.js"><link rel="prefetch" href="/assets/js/102.cfe11c2f.js"><link rel="prefetch" href="/assets/js/103.1c9d82fd.js"><link rel="prefetch" href="/assets/js/104.8d2179cc.js"><link rel="prefetch" href="/assets/js/105.b697a993.js"><link rel="prefetch" href="/assets/js/106.0b049953.js"><link rel="prefetch" href="/assets/js/107.74d0e3ad.js"><link rel="prefetch" href="/assets/js/108.79cc93be.js"><link rel="prefetch" href="/assets/js/11.27d47b43.js"><link rel="prefetch" href="/assets/js/12.f48fc1ba.js"><link rel="prefetch" href="/assets/js/13.78b7cc30.js"><link rel="prefetch" href="/assets/js/14.8bff631b.js"><link rel="prefetch" href="/assets/js/15.20627438.js"><link rel="prefetch" href="/assets/js/16.67e48995.js"><link rel="prefetch" href="/assets/js/17.01045f3b.js"><link rel="prefetch" href="/assets/js/18.6afa9f8a.js"><link rel="prefetch" href="/assets/js/19.27b73a3e.js"><link rel="prefetch" href="/assets/js/2.79b17bef.js"><link rel="prefetch" href="/assets/js/20.3e81158e.js"><link rel="prefetch" href="/assets/js/21.b3a681a9.js"><link rel="prefetch" href="/assets/js/22.c4b7039d.js"><link rel="prefetch" href="/assets/js/23.93d71043.js"><link rel="prefetch" href="/assets/js/24.22532f19.js"><link rel="prefetch" href="/assets/js/25.b8ca8c03.js"><link rel="prefetch" href="/assets/js/26.a799dd2f.js"><link rel="prefetch" href="/assets/js/27.c36435c4.js"><link rel="prefetch" href="/assets/js/28.a3ed4ce8.js"><link rel="prefetch" href="/assets/js/29.e38d5359.js"><link rel="prefetch" href="/assets/js/3.7a23852d.js"><link rel="prefetch" href="/assets/js/30.c8bff20f.js"><link rel="prefetch" href="/assets/js/31.2b63ea05.js"><link rel="prefetch" href="/assets/js/32.5eb78af3.js"><link rel="prefetch" href="/assets/js/33.f37eb57b.js"><link rel="prefetch" href="/assets/js/34.c7d3713b.js"><link rel="prefetch" href="/assets/js/35.6d2ab721.js"><link rel="prefetch" href="/assets/js/36.f26d4302.js"><link rel="prefetch" href="/assets/js/37.6619882e.js"><link rel="prefetch" href="/assets/js/38.8fc45332.js"><link rel="prefetch" href="/assets/js/39.1af4045e.js"><link rel="prefetch" href="/assets/js/4.9de6e436.js"><link rel="prefetch" href="/assets/js/40.57d5eaed.js"><link rel="prefetch" href="/assets/js/41.d3d1f7d5.js"><link rel="prefetch" href="/assets/js/42.0edfe03d.js"><link rel="prefetch" href="/assets/js/43.2226e230.js"><link rel="prefetch" href="/assets/js/44.b5da95bb.js"><link rel="prefetch" href="/assets/js/45.6a7a243e.js"><link rel="prefetch" href="/assets/js/46.359ca4c4.js"><link rel="prefetch" href="/assets/js/47.de522185.js"><link rel="prefetch" href="/assets/js/48.d46de4ab.js"><link rel="prefetch" href="/assets/js/49.5a417db8.js"><link rel="prefetch" href="/assets/js/5.7ad9792b.js"><link rel="prefetch" href="/assets/js/50.726feec1.js"><link rel="prefetch" href="/assets/js/51.e00b51a5.js"><link rel="prefetch" href="/assets/js/52.b08867a3.js"><link rel="prefetch" href="/assets/js/53.b51c6b43.js"><link rel="prefetch" href="/assets/js/54.17d7447a.js"><link rel="prefetch" href="/assets/js/55.cceeea20.js"><link rel="prefetch" href="/assets/js/56.c000a428.js"><link rel="prefetch" href="/assets/js/57.b2d67496.js"><link rel="prefetch" href="/assets/js/58.5410b1e2.js"><link rel="prefetch" href="/assets/js/59.8430d287.js"><link rel="prefetch" href="/assets/js/6.3d9c41ab.js"><link rel="prefetch" href="/assets/js/60.9c80e2db.js"><link rel="prefetch" href="/assets/js/61.6b6dfbbb.js"><link rel="prefetch" href="/assets/js/62.a56c9c18.js"><link rel="prefetch" href="/assets/js/63.3e97184b.js"><link rel="prefetch" href="/assets/js/64.e42a44d5.js"><link rel="prefetch" href="/assets/js/65.1343d703.js"><link rel="prefetch" href="/assets/js/66.905d8d75.js"><link rel="prefetch" href="/assets/js/67.5814750a.js"><link rel="prefetch" href="/assets/js/68.64f1e00b.js"><link rel="prefetch" href="/assets/js/69.b8229c96.js"><link rel="prefetch" href="/assets/js/7.3324267b.js"><link rel="prefetch" href="/assets/js/70.40f58544.js"><link rel="prefetch" href="/assets/js/71.e5de5b46.js"><link rel="prefetch" href="/assets/js/72.a485de3d.js"><link rel="prefetch" href="/assets/js/73.5a60e496.js"><link rel="prefetch" href="/assets/js/74.a67d4e48.js"><link rel="prefetch" href="/assets/js/75.4ba599f2.js"><link rel="prefetch" href="/assets/js/76.d7d2afd5.js"><link rel="prefetch" href="/assets/js/77.5eebb39f.js"><link rel="prefetch" href="/assets/js/78.f3435419.js"><link rel="prefetch" href="/assets/js/79.4812ffbb.js"><link rel="prefetch" href="/assets/js/8.26311239.js"><link rel="prefetch" href="/assets/js/80.dd9718ce.js"><link rel="prefetch" href="/assets/js/81.3e14a311.js"><link rel="prefetch" href="/assets/js/82.36f562fc.js"><link rel="prefetch" href="/assets/js/83.d50c22d4.js"><link rel="prefetch" href="/assets/js/84.0e4e5e21.js"><link rel="prefetch" href="/assets/js/85.5125c3c3.js"><link rel="prefetch" href="/assets/js/86.89407736.js"><link rel="prefetch" href="/assets/js/87.5830787b.js"><link rel="prefetch" href="/assets/js/88.2c8979b8.js"><link rel="prefetch" href="/assets/js/89.db36829e.js"><link rel="prefetch" href="/assets/js/9.2de57e36.js"><link rel="prefetch" href="/assets/js/90.d3819edc.js"><link rel="prefetch" href="/assets/js/91.c30b4ea0.js"><link rel="prefetch" href="/assets/js/92.a9a0a98e.js"><link rel="prefetch" href="/assets/js/93.feccbfe7.js"><link rel="prefetch" href="/assets/js/94.ad57aa83.js"><link rel="prefetch" href="/assets/js/95.824fa7d5.js"><link rel="prefetch" href="/assets/js/96.a897d7a8.js"><link rel="prefetch" href="/assets/js/97.266e9e51.js"><link rel="prefetch" href="/assets/js/98.1e7513d5.js"><link rel="prefetch" href="/assets/js/99.65c0ab26.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa6af71c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jovins Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source/swift/" class="nav-link">Swift</a></div><div class="nav-item"><a href="/source/swiftui/" class="nav-link router-link-active">SwiftUI</a></div><div class="nav-item"><a href="/source/summary/" class="nav-link">Summary</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source/swift/" class="nav-link">Swift</a></div><div class="nav-item"><a href="/source/swiftui/" class="nav-link router-link-active">SwiftUI</a></div><div class="nav-item"><a href="/source/summary/" class="nav-link">Summary</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>SwiftUI 官方教程</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/source/swiftui/" class="sidebar-link">SwiftUI 官方教程一: SwiftUI</a></li><li><a href="/source/swiftui/SwiftUI-tutorial-02.html" class="sidebar-link">SwiftUI官方教程二: 创建和组合视图</a></li><li><a href="/source/swiftui/SwiftUI-tutorial-03.html" class="sidebar-link">SwiftUI 官方教程三: 构建列表与导航</a></li><li><a href="/source/swiftui/SwiftUI-tutorial-04.html" class="active sidebar-link">SwiftUI 官方教程四: 处理用户输入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source/swiftui/SwiftUI-tutorial-04.html#_1-标记用户收藏的地标" class="sidebar-link">1. 标记用户收藏的地标</a></li><li class="sidebar-sub-header"><a href="/source/swiftui/SwiftUI-tutorial-04.html#_2-过滤-list-view" class="sidebar-link">2. 过滤 List View</a></li><li class="sidebar-sub-header"><a href="/source/swiftui/SwiftUI-tutorial-04.html#_3-添加控件来切换状态" class="sidebar-link">3. 添加控件来切换状态</a></li><li class="sidebar-sub-header"><a href="/source/swiftui/SwiftUI-tutorial-04.html#_4-使用-bindable-object-进行存储" class="sidebar-link">4. 使用 Bindable Object 进行存储</a></li><li class="sidebar-sub-header"><a href="/source/swiftui/SwiftUI-tutorial-04.html#_5-在-view-中接受模型对象" class="sidebar-link">5. 在 View 中接受模型对象</a></li><li class="sidebar-sub-header"><a href="/source/swiftui/SwiftUI-tutorial-04.html#_6-给每个-landmark-创建收藏按钮" class="sidebar-link">6. 给每个 Landmark 创建收藏按钮</a></li></ul></li><li><a href="/source/swiftui/SwiftUI-tutorial-05.html" class="sidebar-link">SwiftUI 官方教程五: 绘制Path和Shape</a></li><li><a href="/source/swiftui/SwiftUI-tutorial-06.html" class="sidebar-link">SwiftUI 官方教程六: 动画View与转场</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="swiftui-官方教程四-处理用户输入"><a href="#swiftui-官方教程四-处理用户输入" aria-hidden="true" class="header-anchor">#</a> SwiftUI 官方教程四: 处理用户输入</h1> <blockquote><p>在 <code>Landmarks</code> app 中，用户可以标记他们喜欢的地点，并在列表中过滤出来。要实现这个功能，我们要先在列表中添加一个开关，这样用户可以只看到他们收藏的内容。另外还会添加一个星形按钮，用户可以点击该按钮来收藏地标。</p> <p>下载起始项目文件并按照以下步骤操作，也可以打开已完成的项目自行浏览代码。</p> <ul><li>预计完成时间：20 分钟</li> <li>初始项目文件：<a href="https://github.com/Jovins/SwiftUI-Training/tree/master/HandlingUserInput" target="_blank" rel="noopener noreferrer">Demo下载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></blockquote> <h2 id="_1-标记用户收藏的地标"><a href="#_1-标记用户收藏的地标" aria-hidden="true" class="header-anchor">#</a> 1. 标记用户收藏的地标</h2> <p>首先，通过优化列表来清晰地给用户显示他们的收藏。给每个被收藏地标的 <code>LandmarkRow</code> 添加一颗星。</p> <p><img src="/assets/img/SwiftUI-73.750d8355.png" alt></p> <p><strong>1.1 打开起始项目，在 <code>Project navigator</code> 中选择 <code>LandmarkRow.swift</code> 。</strong></p> <p><img src="/assets/img/SwiftUI-74.dbb488ba.png" alt></p> <p><strong>1.2 在 <code>spacer</code> 的下面添加一个 <code>if</code> 语句，在其中添加一个星形图片来测试当前地标是否被收藏。</strong></p> <p>在 <code>SwiftUI</code> block 中，我们使用 <code>if</code> 语句来有条件的引入 view 。</p> <blockquote><p>LandmarkRow.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkRow</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> landmark<span class="token punctuation">:</span> <span class="token builtin">Landmark</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">HStack</span> <span class="token punctuation">{</span>
            landmark<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>forSize<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
            <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                <span class="token function">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string">&quot;star.fill&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">imageScale</span><span class="token punctuation">(</span><span class="token punctuation">.</span>medium<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkRow_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">Group</span> <span class="token punctuation">{</span>
            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmarkData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmarkData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">previewLayout</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">fixed</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-75.53cca941.png" alt></p> <p><strong>1.3 由于系统图片是基于矢量的，所以我们可以通过 <code>foregroundColor(_:)</code> 方法来修改它们的颜色。</strong></p> <p>当 <code>landmark</code> 的 <code>isFavorite</code> 属性为 <code>true</code> 时，星星就会显示。稍后我们会在教程中看到如何修改这个属性。</p> <blockquote><p>LandmarkRow.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkRow</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> landmark<span class="token punctuation">:</span> <span class="token builtin">Landmark</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">HStack</span> <span class="token punctuation">{</span>
            landmark<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>forSize<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
            <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                <span class="token function">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string">&quot;star.fill&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">imageScale</span><span class="token punctuation">(</span><span class="token punctuation">.</span>medium<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>yellow<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkRow_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">Group</span> <span class="token punctuation">{</span>
            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmarkData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmarkData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">previewLayout</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">fixed</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-76.7bbf59b8.png" alt></p> <h2 id="_2-过滤-list-view"><a href="#_2-过滤-list-view" aria-hidden="true" class="header-anchor">#</a> 2. 过滤 List View</h2> <p>我们可以自定义 list view 让它显示所有的地标，也可以只显示用户收藏的。为此，我们需要给 <code>LandmarkList</code> 类型添加一点 <code>state</code> 。</p> <p><code>state</code> 是一个值或一组值，它可以随时间变化，并且会影响视图的行为、内容或布局。我们用具有 <code>@State</code> 特征的属性将 <code>state</code> 添加到 view 中。</p> <p><img src="/assets/img/SwiftUI-77.4cd5888b.png" alt></p> <p><strong>2.1 在 <code>Project navigator</code> 中选择 <code>LandmarkList.swift</code> ，添加一个名叫 <code>showFavoritesOnly</code>的 <code>@State</code> 属性，把它的初始值设为 <code>false</code> 。</strong></p> <blockquote><p>LandmarkList.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">State</span> <span class="token keyword">var</span> showFavoritesOnly <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token function">List</span><span class="token punctuation">(</span>landmarkData<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                <span class="token function">NavigationButton</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-78.d36a72b4.png" alt></p> <p><strong>2.2 点击 <code>Resume</code> 按钮来刷新 <code>canvas</code> 。</strong></p> <p>当我们对 view 的结构进行更改，比如添加或修改属性时，需要手动刷新 <code>canvas</code> 。</p> <p><img src="/assets/img/SwiftUI-79.dad47653.png" alt></p> <p><strong>2.3 通过检查 <code>showFavoritesOnly</code> 属性和每个 <code>landmark.isFavorite</code> 的值来过滤地标列表。</strong></p> <blockquote><p>LandmarkList.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">State</span> <span class="token keyword">var</span> showFavoritesOnly <span class="token operator">=</span> <span class="token boolean">false</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token function">List</span><span class="token punctuation">(</span>landmarkData<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>showFavoritesOnly <span class="token operator">||</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                    <span class="token function">NavigationButton</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-80.1fd9f3bc.png" alt></p> <h2 id="_3-添加控件来切换状态"><a href="#_3-添加控件来切换状态" aria-hidden="true" class="header-anchor">#</a> 3. 添加控件来切换状态</h2> <p>为了让用户控制列表的过滤，我们需要一个可以修改 <code>showFavoritesOnly</code> 值的控件。通过给切换控件传递一个 <code>binding</code> 来实现这个需求。</p> <p><code>binding</code> 是对可变状态的引用。当用户将状态从关闭切换为打开然后再关闭时，控件使用 <code>binding</code> 来更新 view 相应的状态。</p> <p><img src="/assets/img/SwiftUI-81.3fc692da.png" alt></p> <p><strong>3.1 创建一个嵌套的 <code>ForEach group</code> 将 <code>landmarks</code> 转换为 <code>rows</code> 。</strong></p> <p>若要在列表中组合静态和动态 view ，或者将两个或多个不同的动态 view 组合在一起，要使用 <code>ForEach</code> 类型，而不是将数据集合传递给 <code>List</code> 。</p> <blockquote><p>LandmarkList.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">State</span> <span class="token keyword">var</span> showFavoritesOnly <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token builtin">List</span> <span class="token punctuation">{</span>
                <span class="token function">ForEach</span><span class="token punctuation">(</span>landmarkData<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>showFavoritesOnly <span class="token operator">||</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                        <span class="token function">NavigationButton</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-82.9c6bb844.png" alt></p> <p><strong>3.2 添加一个 <code>Toggle</code> view 作为 <code>List</code> view 的第一个子项，然后给 <code>showFavoritesOnly</code> 传递一个 <code>binding</code>。</strong></p> <p>我们使用 <code>$</code> 前缀来访问一个状态变量或者它的属性的 <code>binding</code> 。</p> <blockquote><p>LandmarkList.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">State</span> <span class="token keyword">var</span> showFavoritesOnly <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token builtin">List</span> <span class="token punctuation">{</span>
                <span class="token function">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $showFavoritesOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Favorites only&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token function">ForEach</span><span class="token punctuation">(</span>landmarkData<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>showFavoritesOnly <span class="token operator">||</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                        <span class="token function">NavigationButton</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-83.92fdeba0.png" alt></p> <p><strong>3.3 使用实时预览并点击切换来尝试这个新功能。</strong></p> <p><img src="/assets/img/SwiftUI-84.c7edc504.gif" alt></p> <h2 id="_4-使用-bindable-object-进行存储"><a href="#_4-使用-bindable-object-进行存储" aria-hidden="true" class="header-anchor">#</a> 4. 使用 Bindable Object 进行存储</h2> <p>为了让用户控制哪些特定地标被收藏，我们先要把地标数据存储在 <code>bindable object</code> 中。</p> <p><code>bindable object</code> 是数据的自定义对象，它可以从 <code>SwiftUI</code> 环境中的存储绑定到 view 上。 <code>SwiftUI</code> 监视 <code>bindable object</code> 中任何可能影响 view 的修改，并在修改后显示正确的 view 版本。</p> <p><img src="/assets/img/SwiftUI-85.5d77b258.png" alt></p> <p><strong>4.1 创建一个新 <code>Swift</code> 文件，命名为 <code>UserData.swift</code> ，然后声明一个模型类型。</strong></p> <blockquote><p>UserData.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">UserData</span><span class="token punctuation">:</span> <span class="token builtin">BindableObject</span>  <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>4.2 添加必要属性 <code>didChange</code> ，使用 <code>PassthroughSubject</code> 作为发布者。</strong></p> <p><code>PassthroughSubject</code> 是 <code>Combine</code> 框架中一个简易的发布者，它把任何值都直接传递给它的订阅者。 <code>SwiftUI</code> 通过这个发布者订阅我们的对象，然后当数据改变时更新所有需要更新的 view 。</p> <blockquote><p>UserData.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>
<span class="token keyword">import</span> <span class="token builtin">Combine</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">UserData</span><span class="token punctuation">:</span> <span class="token builtin">BindableObject</span>  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> didChange <span class="token operator">=</span> <span class="token builtin">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token builtin">UserData</span><span class="token punctuation">,</span> <span class="token builtin">Never</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>4.3 添加存储属性 <code>showFavoritesOnly</code> 和 <code>landmarks</code> 以及它们的初始值。</strong></p> <blockquote><p>UserData.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>
<span class="token keyword">import</span> <span class="token builtin">Combine</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">UserData</span><span class="token punctuation">:</span> <span class="token builtin">BindableObject</span>  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> didChange <span class="token operator">=</span> <span class="token builtin">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token builtin">UserData</span><span class="token punctuation">,</span> <span class="token builtin">Never</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> showFavoritesOnly <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">var</span> landmarks <span class="token operator">=</span> landmarkData
<span class="token punctuation">}</span>
</code></pre></div><p>当客户端更新模型的数据时，<code>bindable object</code> 需要通知它的订阅者。当任何属性更改时， <code>UserData</code> 应通过它的 <code>didChange</code> 发布者发布更改。</p> <p><strong>4.4 给通过 <code>didChange</code> 发布者发送更新的两个属性创建 <code>didSet handlers</code> 。</strong></p> <blockquote><p>UserData.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>
<span class="token keyword">import</span> <span class="token builtin">Combine</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">UserData</span><span class="token punctuation">:</span> <span class="token builtin">BindableObject</span>  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> didChange <span class="token operator">=</span> <span class="token builtin">PassthroughSubject</span><span class="token operator">&lt;</span><span class="token builtin">UserData</span><span class="token punctuation">,</span> <span class="token builtin">Never</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> showFavoritesOnly <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">{</span>
        <span class="token keyword">didSet</span> <span class="token punctuation">{</span>
            didChange<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> landmarks <span class="token operator">=</span> landmarkData <span class="token punctuation">{</span>
        <span class="token keyword">didSet</span> <span class="token punctuation">{</span>
            didChange<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-在-view-中接受模型对象"><a href="#_5-在-view-中接受模型对象" aria-hidden="true" class="header-anchor">#</a> 5. 在 View 中接受模型对象</h2> <p>现在已经创建了 <code>UserData</code> 对象，我们需要更新 view 来将 <code>UserData</code> 对象用作 app 的数据存储。</p> <p><img src="/assets/img/SwiftUI-86.f95a2b24.png" alt></p> <p><strong>5.1 在 <code>LandmarkList.swift</code> 中，将 <code>showFavoritesOnly</code> 声明换成一个 <code>@EnvironmentObject</code>属性，然后给 <code>preview</code> 添加一个 <code>environmentObject(_:)</code> 方法。</strong></p> <p>一旦将 <code>environmentObject(_:)</code> 应用于父级， <code>userData</code> 属性就会自动获取它的值。</p> <blockquote><p>LandmarkList.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">EnvironmentObject</span> <span class="token keyword">var</span> userData<span class="token punctuation">:</span> <span class="token builtin">UserData</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token builtin">List</span> <span class="token punctuation">{</span>
                <span class="token function">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $showFavoritesOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Favorites only&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token function">ForEach</span><span class="token punctuation">(</span>landmarkData<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>showFavoritesOnly <span class="token operator">||</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                        <span class="token function">NavigationButton</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>5.2 将 <code>showFavoritesOnly</code> 的调用更改成访问 <code>userData</code> 上的相同属性。</strong></p> <p>像 <code>@State</code> 属性一样，我们可以使用 <code>$</code> 前缀访问 <code>userData</code> 对象成员的 <code>binding</code> 。</p> <blockquote><p>LandmarkList.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">EnvironmentObject</span> <span class="token keyword">var</span> userData<span class="token punctuation">:</span> <span class="token builtin">UserData</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token builtin">List</span> <span class="token punctuation">{</span>
                <span class="token function">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $userData<span class="token punctuation">.</span>showFavoritesOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Favorites only&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token function">ForEach</span><span class="token punctuation">(</span>landmarkData<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>userData<span class="token punctuation">.</span>showFavoritesOnly <span class="token operator">||</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                        <span class="token function">NavigationButton</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-87.56b6c735.png" alt></p> <p><strong>5.3 创建 <code>ForEach</code> 对象时，使用 <code>userData.landmarks</code> 作为其数据。</strong></p> <blockquote><p>LandmarkList.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">EnvironmentObject</span> <span class="token keyword">var</span> userData<span class="token punctuation">:</span> <span class="token builtin">UserData</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token builtin">List</span> <span class="token punctuation">{</span>
                <span class="token function">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $userData<span class="token punctuation">.</span>showFavoritesOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Favorites only&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token function">ForEach</span><span class="token punctuation">(</span>userData<span class="token punctuation">.</span>landmarks<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>userData<span class="token punctuation">.</span>showFavoritesOnly <span class="token operator">||</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                        <span class="token function">NavigationButton</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/SwiftUI-87.56b6c735.png" alt></p> <p><strong>5.4 在Xcode 11 beta 3中，LandmarkDetail视图不会自动访问视图层次结构环境中的UserData对象。</strong></p> <p>解决方法是在LandmarkDetail视图中添加environmentObject(_:)修饰符。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">EnvironmentObject</span> <span class="token keyword">var</span> userData<span class="token punctuation">:</span> <span class="token builtin">UserData</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">NavigationView</span> <span class="token punctuation">{</span>
            <span class="token builtin">List</span> <span class="token punctuation">{</span>
                <span class="token function">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $userData<span class="token punctuation">.</span>showFavoritesOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Favorites only&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token function">ForEach</span><span class="token punctuation">(</span>userData<span class="token punctuation">.</span>landmarks<span class="token punctuation">)</span> <span class="token punctuation">{</span> landmark <span class="token keyword">in</span>
                    <span class="token keyword">if</span> <span class="token operator">!</span><span class="token keyword">self</span><span class="token punctuation">.</span>userData<span class="token punctuation">.</span>showFavoritesOnly <span class="token operator">||</span> landmark<span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                        <span class="token function">NavigationLink</span><span class="token punctuation">(</span>
                            destination<span class="token punctuation">:</span> <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>userData<span class="token punctuation">)</span>
                        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">LandmarkRow</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Landmarks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkList_Previews</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>5.5 在 <code>SceneDelegate.swift</code> 中，给 <code>LandmarkList</code> 添加 <code>environmentObject(_:)</code> 方法。</strong></p> <p>如果我们不是使用预览，而是在模拟器或真机上构建或运行 <code>Landmarks</code> ，这个更新可以确保 <code>LandmarkList</code> 在环境中持有 <code>UserData</code> 对象。</p> <blockquote><p>SceneDelegate.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">UIKit</span>
<span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">class</span> <span class="token class-name">SceneDelegate</span><span class="token punctuation">:</span> <span class="token builtin">UIResponder</span><span class="token punctuation">,</span> <span class="token builtin">UIWindowSceneDelegate</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> window<span class="token punctuation">:</span> <span class="token builtin">UIWindow</span><span class="token operator">?</span>

    <span class="token keyword">func</span> <span class="token function">scene</span><span class="token punctuation">(</span><span class="token number">_</span> scene<span class="token punctuation">:</span> <span class="token builtin">UIScene</span><span class="token punctuation">,</span> willConnectTo session<span class="token punctuation">:</span> <span class="token builtin">UISceneSession</span><span class="token punctuation">,</span> options connectionOptions<span class="token punctuation">:</span> <span class="token builtin">UIScene</span><span class="token punctuation">.</span><span class="token builtin">ConnectionOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Use this method to optionally configure and attach the UIWindow `window` to the provided UIWindowScene `scene`.</span>
        <span class="token comment">// If using a storyboard, the `window` property will automatically be initialized and attached to the scene.</span>
        <span class="token comment">// This delegate does not imply the connecting scene or session are new (see `application:configurationForConnectingSceneSession` instead).</span>

        <span class="token comment">// Use a UIHostingController as window root view controller</span>
        <span class="token keyword">let</span> window <span class="token operator">=</span> <span class="token function">UIWindow</span><span class="token punctuation">(</span>frame<span class="token punctuation">:</span> <span class="token builtin">UIScreen</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>bounds<span class="token punctuation">)</span>
        window<span class="token punctuation">.</span>rootViewController <span class="token operator">=</span> <span class="token function">UIHostingController</span><span class="token punctuation">(</span>
            rootView<span class="token punctuation">:</span> <span class="token function">LandmarkList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>window <span class="token operator">=</span> window
        window<span class="token punctuation">.</span><span class="token function">makeKeyAndVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>5.6 更新 <code>LandmarkDetail</code> view 来使用环境中的 <code>UserData</code> 对象。</strong></p> <p>我们使用 <code>landmarkIndex</code> 访问或更新 <code>landmark</code> 的收藏状态，这样就可以始终得到该数据的正确版本。</p> <blockquote><p>LandmarkDetail.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkDetail</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">EnvironmentObject</span> <span class="token keyword">var</span> userData<span class="token punctuation">:</span> <span class="token builtin">UserData</span>
    <span class="token keyword">var</span> landmark<span class="token punctuation">:</span> <span class="token builtin">Landmark</span>

    <span class="token keyword">var</span> landmarkIndex<span class="token punctuation">:</span> <span class="token builtin">Int</span> <span class="token punctuation">{</span>
        userData<span class="token punctuation">.</span>landmarks<span class="token punctuation">.</span><span class="token function">firstIndex</span><span class="token punctuation">(</span><span class="token keyword">where</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> $<span class="token number">0</span><span class="token punctuation">.</span>id <span class="token operator">==</span> landmark<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">!</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">VStack</span> <span class="token punctuation">{</span>
            <span class="token function">MapView</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">)</span>

            <span class="token function">CircleImage</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> landmark<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>forSize<span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">)</span>

            <span class="token function">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
                <span class="token function">HStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>park<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span>caption<span class="token punctuation">)</span>
                    <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>caption<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> displayMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>inline<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkDetail_Preview</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmarkData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>5.7 切回 <code>LandmarkList.swift</code> ，打开实时预览来验证一切是否正常。</strong></p> <p><img src="/assets/img/SwiftUI-88.e1cb7169.png" alt></p> <h2 id="_6-给每个-landmark-创建收藏按钮"><a href="#_6-给每个-landmark-创建收藏按钮" aria-hidden="true" class="header-anchor">#</a> 6. 给每个 Landmark 创建收藏按钮</h2> <p><code>Landmarks</code> app 现在可以在已过滤和未过滤的地标视图之间切换，但收藏的地标仍是硬编码的。为了让用户添加和删除收藏，我们需要在地标详情 view 中添加收藏夹按钮。</p> <p><img src="/assets/img/SwiftUI-89.3b560064.png" alt></p> <p><strong>6.1 在 <code>LandmarkDetail.swift</code> 中，把 <code>landmark.name</code> 嵌套在一个 <code>HStack</code> 中。</strong></p> <blockquote><p>LandmarkDetail.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkDetail</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">EnvironmentObject</span> <span class="token keyword">var</span> userData<span class="token punctuation">:</span> <span class="token builtin">UserData</span>
    <span class="token keyword">var</span> landmark<span class="token punctuation">:</span> <span class="token builtin">Landmark</span>

    <span class="token keyword">var</span> landmarkIndex<span class="token punctuation">:</span> <span class="token builtin">Int</span> <span class="token punctuation">{</span>
        userData<span class="token punctuation">.</span>landmarks<span class="token punctuation">.</span><span class="token function">firstIndex</span><span class="token punctuation">(</span><span class="token keyword">where</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> $<span class="token number">0</span><span class="token punctuation">.</span>id <span class="token operator">==</span> landmark<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">!</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">VStack</span> <span class="token punctuation">{</span>
            <span class="token function">MapView</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">)</span>

            <span class="token function">CircleImage</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> landmark<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>forSize<span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">)</span>

            <span class="token function">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token builtin">HStack</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token function">HStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>park<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span>caption<span class="token punctuation">)</span>
                    <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>caption<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> displayMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>inline<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkDetail_Preview</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmarkData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>6.2 在 <code>landmark.name</code> 下面创建一个新按钮。用 <code>if-else</code> 条件语句给地标传递不同的图片来区分是否被收藏。</strong></p> <p>在按钮的 <code>action</code> 闭包中，代码使用持有 <code>userData</code> 对象的 <code>landmarkIndex</code> 来更新地标。</p> <blockquote><p>LandmarkDetail.swift</p></blockquote> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">SwiftUI</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkDetail</span><span class="token punctuation">:</span> <span class="token builtin">View</span> <span class="token punctuation">{</span>
    @<span class="token builtin">EnvironmentObject</span> <span class="token keyword">var</span> userData<span class="token punctuation">:</span> <span class="token builtin">UserData</span>
    <span class="token keyword">var</span> landmark<span class="token punctuation">:</span> <span class="token builtin">Landmark</span>

    <span class="token keyword">var</span> landmarkIndex<span class="token punctuation">:</span> <span class="token builtin">Int</span> <span class="token punctuation">{</span>
        userData<span class="token punctuation">.</span>landmarks<span class="token punctuation">.</span><span class="token function">firstIndex</span><span class="token punctuation">(</span><span class="token keyword">where</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> $<span class="token number">0</span><span class="token punctuation">.</span>id <span class="token operator">==</span> landmark<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">!</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token builtin">VStack</span> <span class="token punctuation">{</span>
            <span class="token function">MapView</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmark<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">)</span>

            <span class="token function">CircleImage</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> landmark<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>forSize<span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">)</span>

            <span class="token function">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token builtin">HStack</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>title<span class="token punctuation">)</span>

                    <span class="token function">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                        <span class="token keyword">self</span><span class="token punctuation">.</span>userData<span class="token punctuation">.</span>landmarks<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>landmarkIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>isFavorite<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>userData<span class="token punctuation">.</span>landmarks<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>landmarkIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>isFavorite <span class="token punctuation">{</span>
                            <span class="token function">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string">&quot;star.fill&quot;</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token builtin">Color</span><span class="token punctuation">.</span>yellow<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token function">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string">&quot;star&quot;</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token builtin">Color</span><span class="token punctuation">.</span>gray<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token function">HStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>park<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span>caption<span class="token punctuation">)</span>
                    <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>caption<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token function">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">navigationBarTitle</span><span class="token punctuation">(</span><span class="token function">Text</span><span class="token punctuation">(</span>landmark<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> displayMode<span class="token punctuation">:</span> <span class="token punctuation">.</span>inline<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token builtin">LandmarkDetail_Preview</span><span class="token punctuation">:</span> <span class="token builtin">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> some <span class="token builtin">View</span> <span class="token punctuation">{</span>
        <span class="token function">LandmarkDetail</span><span class="token punctuation">(</span>landmark<span class="token punctuation">:</span> landmarkData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token function">UserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>6.3 在 <code>LandmarkList.swift</code> 中打开预览。</strong></p> <p>当我们从列表导航到详情并点击按钮时，我们会在返回列表后看到这些更改仍然存在。由于两个 view 在环境中访问相同的模型对象，因此这两个 view 会保持一致。</p> <p><img src="/assets/img/SwiftUI-89.55de0d6e.gif" alt></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/source/swiftui/SwiftUI-tutorial-03.html" class="prev">
          SwiftUI 官方教程三: 构建列表与导航
        </a></span> <span class="next"><a href="/source/swiftui/SwiftUI-tutorial-05.html">
          SwiftUI 官方教程五: 绘制Path和Shape
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.ad555431.js" defer></script><script src="/assets/js/10.5630b3d6.js" defer></script>
  </body>
</html>
