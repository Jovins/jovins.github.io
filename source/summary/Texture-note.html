<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Texture 开发笔记 | Jovins Blog</title>
    <meta name="description" content="Work Hard, Play Hard">
    <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa6af71c.css" as="style"><link rel="preload" href="/assets/js/app.073bdbcd.js" as="script"><link rel="preload" href="/assets/js/93.97bb2127.js" as="script"><link rel="prefetch" href="/assets/js/10.5f6775c0.js"><link rel="prefetch" href="/assets/js/100.4e91fa52.js"><link rel="prefetch" href="/assets/js/101.be2ad263.js"><link rel="prefetch" href="/assets/js/102.31ad6b6a.js"><link rel="prefetch" href="/assets/js/103.1cff73e3.js"><link rel="prefetch" href="/assets/js/104.23b3d9f8.js"><link rel="prefetch" href="/assets/js/105.2836c5b6.js"><link rel="prefetch" href="/assets/js/106.03b7d5ed.js"><link rel="prefetch" href="/assets/js/107.e3a355c8.js"><link rel="prefetch" href="/assets/js/108.9be54eba.js"><link rel="prefetch" href="/assets/js/109.249699f4.js"><link rel="prefetch" href="/assets/js/11.9be4e5d5.js"><link rel="prefetch" href="/assets/js/12.027a42cd.js"><link rel="prefetch" href="/assets/js/13.80cc652a.js"><link rel="prefetch" href="/assets/js/14.fc5b24f0.js"><link rel="prefetch" href="/assets/js/15.f4398a4f.js"><link rel="prefetch" href="/assets/js/16.35cbe6cb.js"><link rel="prefetch" href="/assets/js/17.89763c73.js"><link rel="prefetch" href="/assets/js/18.e3df4ddf.js"><link rel="prefetch" href="/assets/js/19.1428f628.js"><link rel="prefetch" href="/assets/js/2.86f80066.js"><link rel="prefetch" href="/assets/js/20.4a159b93.js"><link rel="prefetch" href="/assets/js/21.f644e518.js"><link rel="prefetch" href="/assets/js/22.61e94c50.js"><link rel="prefetch" href="/assets/js/23.5bf8cd87.js"><link rel="prefetch" href="/assets/js/24.8468ef53.js"><link rel="prefetch" href="/assets/js/25.e24b4209.js"><link rel="prefetch" href="/assets/js/26.bd18c7c4.js"><link rel="prefetch" href="/assets/js/27.570614e6.js"><link rel="prefetch" href="/assets/js/28.e7acfbd2.js"><link rel="prefetch" href="/assets/js/29.d6cafd8f.js"><link rel="prefetch" href="/assets/js/3.53a53418.js"><link rel="prefetch" href="/assets/js/30.4c3ecc7f.js"><link rel="prefetch" href="/assets/js/31.09d64ca6.js"><link rel="prefetch" href="/assets/js/32.062169c4.js"><link rel="prefetch" href="/assets/js/33.883e6251.js"><link rel="prefetch" href="/assets/js/34.4fbfd1fb.js"><link rel="prefetch" href="/assets/js/35.23dfa221.js"><link rel="prefetch" href="/assets/js/36.2526bb3c.js"><link rel="prefetch" href="/assets/js/37.c9d82c8d.js"><link rel="prefetch" href="/assets/js/38.7fd50f44.js"><link rel="prefetch" href="/assets/js/39.e2ecea04.js"><link rel="prefetch" href="/assets/js/4.57051a78.js"><link rel="prefetch" href="/assets/js/40.ced1c2d0.js"><link rel="prefetch" href="/assets/js/41.85561ab5.js"><link rel="prefetch" href="/assets/js/42.e2f63ec0.js"><link rel="prefetch" href="/assets/js/43.e0f86715.js"><link rel="prefetch" href="/assets/js/44.e488dc97.js"><link rel="prefetch" href="/assets/js/45.e64e6852.js"><link rel="prefetch" href="/assets/js/46.04a17f10.js"><link rel="prefetch" href="/assets/js/47.39a7a069.js"><link rel="prefetch" href="/assets/js/48.3246547a.js"><link rel="prefetch" href="/assets/js/49.a3a6d81c.js"><link rel="prefetch" href="/assets/js/5.082ece4d.js"><link rel="prefetch" href="/assets/js/50.04650e95.js"><link rel="prefetch" href="/assets/js/51.3c129536.js"><link rel="prefetch" href="/assets/js/52.714a0188.js"><link rel="prefetch" href="/assets/js/53.6293c113.js"><link rel="prefetch" href="/assets/js/54.a7728777.js"><link rel="prefetch" href="/assets/js/55.04646dda.js"><link rel="prefetch" href="/assets/js/56.898cd4b7.js"><link rel="prefetch" href="/assets/js/57.4a4fca9f.js"><link rel="prefetch" href="/assets/js/58.8a3e360a.js"><link rel="prefetch" href="/assets/js/59.29aed45f.js"><link rel="prefetch" href="/assets/js/6.2b58e136.js"><link rel="prefetch" href="/assets/js/60.ccecb6c8.js"><link rel="prefetch" href="/assets/js/61.c39c0b91.js"><link rel="prefetch" href="/assets/js/62.b1cf62ab.js"><link rel="prefetch" href="/assets/js/63.b58f9272.js"><link rel="prefetch" href="/assets/js/64.9189f4b1.js"><link rel="prefetch" href="/assets/js/65.0e68b361.js"><link rel="prefetch" href="/assets/js/66.31725a91.js"><link rel="prefetch" href="/assets/js/67.69ae3819.js"><link rel="prefetch" href="/assets/js/68.4e6c87bc.js"><link rel="prefetch" href="/assets/js/69.8015ab75.js"><link rel="prefetch" href="/assets/js/7.e1b4d6af.js"><link rel="prefetch" href="/assets/js/70.a38e1d44.js"><link rel="prefetch" href="/assets/js/71.4ffde0d3.js"><link rel="prefetch" href="/assets/js/72.3b23430b.js"><link rel="prefetch" href="/assets/js/73.aa78acaa.js"><link rel="prefetch" href="/assets/js/74.1458ae8d.js"><link rel="prefetch" href="/assets/js/75.6507b2ca.js"><link rel="prefetch" href="/assets/js/76.365ac95e.js"><link rel="prefetch" href="/assets/js/77.ae56518a.js"><link rel="prefetch" href="/assets/js/78.ff608fcc.js"><link rel="prefetch" href="/assets/js/79.3e90fd58.js"><link rel="prefetch" href="/assets/js/8.306e5c8a.js"><link rel="prefetch" href="/assets/js/80.48f465dc.js"><link rel="prefetch" href="/assets/js/81.926ff06e.js"><link rel="prefetch" href="/assets/js/82.ca967fea.js"><link rel="prefetch" href="/assets/js/83.2b0c5078.js"><link rel="prefetch" href="/assets/js/84.6fe0eef0.js"><link rel="prefetch" href="/assets/js/85.c604ca0d.js"><link rel="prefetch" href="/assets/js/86.341f8a40.js"><link rel="prefetch" href="/assets/js/87.d6910a36.js"><link rel="prefetch" href="/assets/js/88.558d888c.js"><link rel="prefetch" href="/assets/js/89.05f881cd.js"><link rel="prefetch" href="/assets/js/9.3d226234.js"><link rel="prefetch" href="/assets/js/90.e5925c90.js"><link rel="prefetch" href="/assets/js/91.c760f19c.js"><link rel="prefetch" href="/assets/js/92.50a3d7c2.js"><link rel="prefetch" href="/assets/js/94.afaa54c2.js"><link rel="prefetch" href="/assets/js/95.777e6ccc.js"><link rel="prefetch" href="/assets/js/96.434400e7.js"><link rel="prefetch" href="/assets/js/97.d5f4078d.js"><link rel="prefetch" href="/assets/js/98.e4f67ccd.js"><link rel="prefetch" href="/assets/js/99.d7b9c6ae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa6af71c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Jovins Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/source/swift/" class="nav-link">Swift</a></div><div class="nav-item"><a href="/source/swiftui/" class="nav-link">SwiftUI</a></div><div class="nav-item"><a href="/source/summary/" class="nav-link router-link-active">Summary</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/source/swift/" class="nav-link">Swift</a></div><div class="nav-item"><a href="/source/swiftui/" class="nav-link">SwiftUI</a></div><div class="nav-item"><a href="/source/summary/" class="nav-link router-link-active">Summary</a></div><div class="nav-item"><a href="/source/go/" class="nav-link">Go</a></div><div class="nav-item"><a href="/source/program/" class="nav-link">小程序</a></div><div class="nav-item"><a href="/source/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/source/git/" class="nav-link">Git</a></div><div class="nav-item"><a href="https://github.com/Jovins" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>技术杂谈</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/source/summary/" class="sidebar-link">Reading List</a></li><li><a href="/source/summary/Texture-note.html" class="active sidebar-link">Texture 开发笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/source/summary/Texture-note.html#asimagenode" class="sidebar-link">ASImageNode</a></li><li class="sidebar-sub-header"><a href="/source/summary/Texture-note.html#aslayoutspec" class="sidebar-link">ASLayoutSpec</a></li><li class="sidebar-sub-header"><a href="/source/summary/Texture-note.html#aseditabletextnode" class="sidebar-link">ASEditableTextNode</a></li><li class="sidebar-sub-header"><a href="/source/summary/Texture-note.html#astablenode-和-ascollectionnode" class="sidebar-link">ASTableNode 和 ASCollectionNode</a></li></ul></li><li><a href="/source/summary/Texture-why.html" class="sidebar-link">为什么使用Texture</a></li><li><a href="/source/summary/Texture-official-concept.html" class="sidebar-link">Texture 基本概念</a></li><li><a href="/source/summary/Texture-official-layout.html" class="sidebar-link">Texture 布局</a></li><li><a href="/source/summary/UIScrollView-touch-conflict.html" class="sidebar-link">UIScrollView嵌套滚动解决手势冲突</a></li><li><a href="/source/summary/2018-reporter.html" class="sidebar-link">2018-小记</a></li><li><a href="/source/summary/iOS-Memory-explore.html" class="sidebar-link">iOS内存管理探究</a></li><li><a href="/source/summary/fastlane-auto-dev.html" class="sidebar-link">fastlane自动化开发组件</a></li><li><a href="/source/summary/dev-component.html" class="sidebar-link">组件化开发之开发小组件</a></li><li><a href="/source/summary/Resume-01.html" class="sidebar-link">总结上</a></li><li><a href="/source/summary/Resume-02.html" class="sidebar-link">总结中</a></li><li><a href="/source/summary/Resume-03.html" class="sidebar-link">总结下</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="texture-开发笔记"><a href="#texture-开发笔记" aria-hidden="true" class="header-anchor">#</a> Texture 开发笔记</h1> <h2 id="asimagenode"><a href="#asimagenode" aria-hidden="true" class="header-anchor">#</a> ASImageNode</h2> <p>ASImageNode 不支持直接设置 <code>tintColor</code> ，如果需要设置 tintColor需要通过 <code>imageModificationBlock</code> 进行设置：</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>imageNode.imageModificationBlock = ASImageNodeTintColorModificationBlock(UIColor.white)
</code></pre></div><p><a href="https://github.com/facebookarchive/AsyncDisplayKit/issues/426" target="_blank" rel="noopener noreferrer">github上的相关讨论<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>还有就是如果需要改变ASButtonNode 的 imageNode 的 tintColor，是改不了的，需要通过设置不同状态的图片，然后通过改变buttonNode的状态来改变图片。</p> <div class="language-swift extra-class"><pre class="language-swift"><code>buttonNode<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>normal<span class="token punctuation">)</span>
buttonNode<span class="token punctuation">.</span><span class="token function">setImage</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span><span class="token function">tinted</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token builtin">UIColor</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>selected<span class="token punctuation">)</span>
</code></pre></div><h2 id="aslayoutspec"><a href="#aslayoutspec" aria-hidden="true" class="header-anchor">#</a> ASLayoutSpec</h2> <p>当 spaceBetween 没有达到两端对齐的效果，尝试设置当前 layoutSpec 的 width（如注释）或它的上一级布局对象的 alignItems，在例子中就是 stackLayout.alignItems = .stretch。</p> <p><strong>ASDisplayNode的高度计算</strong></p> <p>如果在 UIView 或者UITableViewCell中添加ASDisplayNode，而且需要计算ASDisplayNode的高度，在 ASDisplayNode 实现了<code>- (ASLayoutSpec *)layoutSpecThatFits:(ASSizeRange)constrainedSize</code> 情况下，可以调用 <code>- (ASLayout *)layoutThatFits:(ASSizeRange)constrainedSize</code> 方法计算出大小。</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token number">_</span> <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">layoutThatFits</span><span class="token punctuation">(</span><span class="token function">ASSizeRangeMake</span><span class="token punctuation">(</span><span class="token builtin">CGSize</span><span class="token punctuation">.</span>zero<span class="token punctuation">,</span>
						  <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> view<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>width<span class="token punctuation">,</span>	height<span class="token punctuation">:</span> <span class="token builtin">CGFloat</span><span class="token punctuation">.</span>greatestFiniteMagnitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>calculatedSize<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
</code></pre></div><p><strong>给 ASDisplayNode 的 View 添加手势</strong></p> <blockquote><p>-didLoad
This method is conceptually similar to UIViewController’s -viewDidLoad method; it’s called once and is the point where the backing view has been loaded. It is guaranteed to be called on the main thread and is the appropriate place to do any UIKit things (such as adding gesture recognizers, touching the view / layer, initializing UIKit objects).</p></blockquote> <p>需要在didLoad中添加</p> <div class="language- extra-class"><pre class="language-text"><code>/** @name View Lifecycle */
    
    /**
     * @abstract Called on the main thread immediately after self.view is created.
     *
     * @discussion This is the best time to add gesture recognizers to the view.
     */
open func didLoad()
</code></pre></div><p><strong>ASDisplayNode 使用 initWithViewBlock 方法进行初始化</strong></p> <p>需要注意 <code>retain cycle</code> 的问题，持有 self 变量要设置为 <code>weak</code>。另外ASDisplayNode 并不知道自己持有的View的大小，需要对 <code>style.preferredSize</code> 进行设置。</p> <p><strong>ASTextNode2 attachment的问题</strong></p> <p>ASTextNode2 目前尚未支持通过添加 NSTextAttachment 的方式在 NSAttributedString 后面添加图片，如果需要实现上面的需求要使用ASTextNode。</p> <p><strong>ASCellNode里面再嵌套UITableViewCell</strong></p> <p>为了复用一些布局，比如个人界面的设置Cell，采用了在ASCellNode使用viewBlock方法来复用Cell。</p> <div class="language- extra-class"><pre class="language-text"><code>let cellNode = ASCellNode(viewBlock: { () -&gt; UIView in
						let cell = UITableViewCell(style: .default, reuseIdentifier: nil)
	//					cell.isUserInteractionEnabled = false
						return cell
					})
</code></pre></div><p>显示出来的布局是正常的，在iOS 11上点击也可以跳转，但是今天在iOS 10上测试的时候发现无法响应点击事件，如果是用UIView生成也可以响应点击事件，怀疑是UITableViewCell拦截了点击事件，但是为什么在iOS 11上可以，iOS 10上就不可以？不知道。加上 ：</p> <div class="language- extra-class"><pre class="language-text"><code>cell.isUserInteractionEnabled = false
</code></pre></div><p>在iOS 10也可以响应点击事件了。</p> <h2 id="aseditabletextnode"><a href="#aseditabletextnode" aria-hidden="true" class="header-anchor">#</a> ASEditableTextNode</h2> <p>ASEditableTextNode 默认高度只能适应英文字母，如果输入中文会发现被裁了一截，所以在初始化时需要指定一下 ASEditableTextNode 的高度</p> <div class="language-swift extra-class"><pre class="language-swift"><code><span class="token keyword">let</span> editableTextNode <span class="token operator">=</span> <span class="token function">ASEditableTextNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
editableTextNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token function">ASDimensionMake</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="astablenode-和-ascollectionnode"><a href="#astablenode-和-ascollectionnode" aria-hidden="true" class="header-anchor">#</a> ASTableNode 和 ASCollectionNode</h2> <p><strong>ASTableNode，ASCollectionNode调用reloadData时闪烁的问题</strong></p> <p>在ASTableNode和ASCollectionNode需要刷新时不推荐直接使用 <code>reloadData</code> ，直接调用 <code>reloadData</code> 时会发现整个node都会闪一下。
一个比较好的解决方法是每次刷新算出需要添加，删除或者刷新的 <code>indexPath</code> 或者 <code>section</code>，再对这部分调用对应的局部刷新方法。</p> <div class="language-objective-c extra-class"><pre class="language-text"><code>// indexPaths
- (void)insertRowsAtIndexPaths:(NSArray *)indexPaths withRowAnimation:(UITableViewRowAnimation)animation;
- (void)deleteRowsAtIndexPaths:(NSArray *)indexPaths withRowAnimation:(UITableViewRowAnimation)animation;
- (void)reloadRowsAtIndexPaths:(NSArray *)indexPaths withRowAnimation:(UITableViewRowAnimation)animation;

// sections
- (void)insertSections:(NSIndexSet *)sections withRowAnimation:(UITableViewRowAnimation)animation;
- (void)deleteSections:(NSIndexSet *)sections withRowAnimation:(UITableViewRowAnimation)animation;
- (void)reloadSections:(NSIndexSet *)sections withRowAnimation:(UITableViewRowAnimation)animation;
</code></pre></div><p><strong>ASTableNode，ASCollectionNode 的 cellNode 没有复用的问题</strong></p> <p>ASTableNode(ASCollectionNode) 与 UITableView(UICollectionView) 最大的不同应该是 ASTableNode(ASCollectionNode) 的 cellNode 没有复用机制，所以在 ASTableNode(ASCollectionNode) 中滚动时，经过多少个 cellNode 就会生成多少个 cellNode，这让 ASTableNode(ASCollectionNode) 占用的内存会比 UITableView(UICollectionView) 大不少，尤其是 cellNode 中包含图片或者 Gif 时。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/source/summary/" class="prev router-link-active">
          Reading List
        </a></span> <span class="next"><a href="/source/summary/Texture-why.html">
          为什么使用Texture
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.073bdbcd.js" defer></script><script src="/assets/js/93.97bb2127.js" defer></script>
  </body>
</html>
